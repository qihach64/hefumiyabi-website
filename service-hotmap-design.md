# Service Hotmap Integration Design (v3)

## è®¾è®¡å†³ç­–

- **æ ¸å¿ƒç›®çš„**ï¼šå±•ç¤ºä¿¡æ¯å®Œæ•´æ€§ï¼ˆå¥—é¤åŒ…å«çš„æ‰€æœ‰æœåŠ¡ï¼‰
- **çƒ­ç‚¹å›¾å›¾ç‰‡**ï¼šé¼“åŠ±å•†æˆ·ä¸Šä¼ è‡ªå®šä¹‰å›¾ç‰‡ï¼Œå«Œéº»çƒ¦å¯ç”¨å¹³å°æ¨¡æ¿
- **ç»„ä»¶åˆ†ç±»**ï¼šåªæœ‰ä¸¤ç§ - å¹³å°ç»„ä»¶ / å•†æˆ·ç»„ä»¶
- **å•†æˆ·ç»„ä»¶**ï¼šæ— éœ€å®¡æ ¸ï¼Œä»…åˆ›å»ºè€…å¯ç”¨ï¼Œå…¶ä»–å•†æˆ·ä¸å¯è§
- **ç»„ä»¶å‡çº§**ï¼šç®¡ç†å‘˜å¯å°†ä¼˜ç§€å•†æˆ·ç»„ä»¶å‡çº§ä¸ºå¹³å°ç»„ä»¶
- **æ•°æ®å­˜å‚¨**ï¼šçƒ­ç‚¹ä½ç½®å­˜åœ¨ `PlanComponent` é‡Œï¼ˆæ¯ä¸ªå¥—é¤ç‹¬ç«‹ï¼‰

---

## æ ¸å¿ƒå®ä½“å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           å¹³å°å±‚ (Platform)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ServiceComponent (ç»„ä»¶åº“)                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å¹³å°ç»„ä»¶ (isSystemComponent = true)                             â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ ğŸ‘˜ æŒ¯è¢–å’Œæœ                                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ ğŸ€ å¸¯ãƒ»å¸¯ç· ã‚                                               â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ ğŸ’„ å‘å‹è®¾è®¡                                                 â”‚   â”‚
â”‚  â”‚  â””â”€â”€ ğŸ“¸ æ‘„å½±æœåŠ¡                                                 â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  å•†æˆ·ç»„ä»¶ (merchantId != null, ä»…åˆ›å»ºè€…å¯è§)                      â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ âœ¨ [å•†æˆ·A] ç‰¹åˆ¶é‡‘ç®”å‘é¥°                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ ğŸŒ¸ [å•†æˆ·B] æ¨±èŠ±ä¸»é¢˜å°ç‰©                                      â”‚   â”‚
â”‚  â”‚  â””â”€â”€ ...                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  MapTemplate (çƒ­ç‚¹å›¾æ¨¡æ¿ - å¤‡é€‰æ–¹æ¡ˆ)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å¥³å£«æŒ¯è¢–æ¨¡æ¿ / ç”·å£«ç¾½ç»‡è¢´æ¨¡æ¿ / æƒ…ä¾£æ¨¡æ¿ / ...                   â”‚   â”‚
â”‚  â”‚  (å•†æˆ·å«Œéº»çƒ¦æ—¶å¯é€‰æ‹©ä½¿ç”¨)                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           å•†æˆ·å±‚ (Merchant)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  RentalPlan (å¥—é¤)                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ çƒ­ç‚¹å›¾é…ç½®:                                                       â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚ â”‚ hotmapImageUrl: å•†æˆ·ä¸Šä¼ çš„å›¾ç‰‡ (æ¨è)                        â”‚  â”‚   â”‚
â”‚  â”‚ â”‚         - æˆ– -                                               â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ hotmapTemplateId: é€‰æ‹©çš„å¹³å°æ¨¡æ¿ (å¤‡é€‰)                      â”‚  â”‚   â”‚
â”‚  â”‚ â”‚         - æˆ– -                                               â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ éƒ½ä¸ºç©ºæ—¶: æ ¹æ® themeId è‡ªåŠ¨ä½¿ç”¨å¯¹åº”æ¨¡æ¿                       â”‚  â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚ PlanComponent[] (å¥—é¤ç»„ä»¶ + çƒ­ç‚¹ä½ç½®)                             â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚ â”‚ ğŸ‘˜ æŒ¯è¢–å’Œæœ (å¹³å°)    hotmapX: 0.5, hotmapY: 0.3             â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ âœ¨ ç‰¹åˆ¶å‘é¥° (å•†æˆ·è‡ªå®šä¹‰) hotmapX: 0.3, hotmapY: 0.2          â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ ğŸ’„ å‘å‹è®¾è®¡ (å¹³å°)    hotmapX: null (ä¸æ˜¾ç¤ºåœ¨å›¾ä¸Š)           â”‚  â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®æ¨¡å‹è®¾è®¡

### ServiceComponent æ›´æ–°

```prisma
model ServiceComponent {
  id              String          @id @default(cuid())
  code            String          @unique

  // åŸºæœ¬ä¿¡æ¯
  name            String
  nameJa          String?         @map("name_ja")
  nameEn          String?         @map("name_en")
  description     String?         @db.Text
  type            ComponentType   // KIMONO, STYLING, ACCESSORY, EXPERIENCE
  icon            String?

  // ========== ç»„ä»¶æ‰€æœ‰æƒ ==========
  // true = å¹³å°ç»„ä»¶ï¼ˆå…¨éƒ¨å•†æˆ·å¯è§ï¼‰
  // false = å•†æˆ·ç»„ä»¶ï¼ˆä»…åˆ›å»ºè€…å¯è§ï¼‰
  isSystemComponent  Boolean   @default(false) @map("is_system_component")

  // å•†æˆ·ç»„ä»¶çš„æ‰€æœ‰è€…ï¼ˆå¹³å°ç»„ä»¶æ­¤å­—æ®µä¸º nullï¼‰
  merchantId         String?   @map("merchant_id")
  merchant           Merchant? @relation(fields: [merchantId], references: [id], onDelete: Cascade)

  // å‡çº§è®°å½•ï¼šå•†æˆ·ç»„ä»¶è¢«å‡çº§ä¸ºå¹³å°ç»„ä»¶æ—¶ï¼Œè®°å½•åŸå•†æˆ· ID
  promotedFromMerchantId  String?   @map("promoted_from_merchant_id")
  promotedAt              DateTime? @map("promoted_at")

  // å®šä»·ä¿¡æ¯
  basePrice       Int             @default(0) @map("base_price")

  // å…ƒæ•°æ®
  displayOrder    Int             @default(0) @map("display_order")
  isActive        Boolean         @default(true) @map("is_active")
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")

  // å…³è”
  planComponents  PlanComponent[]
  mapHotspots     MapHotspot[]

  @@index([isSystemComponent, isActive])
  @@index([merchantId])
  @@map("service_components")
}
```

### RentalPlan æ›´æ–°

```prisma
model RentalPlan {
  // ... ç°æœ‰å­—æ®µ ...

  // ========== çƒ­ç‚¹å›¾é…ç½® ==========
  // å•†æˆ·è‡ªå®šä¹‰çƒ­ç‚¹å›¾ç‰‡ï¼ˆæ¨èä½¿ç”¨ï¼‰
  hotmapImageUrl     String?      @map("hotmap_image_url")

  // é€‰æ‹©çš„å¹³å°æ¨¡æ¿ï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼Œå½“æ²¡æœ‰è‡ªå®šä¹‰å›¾ç‰‡æ—¶ï¼‰
  hotmapTemplateId   String?      @map("hotmap_template_id")
  hotmapTemplate     MapTemplate? @relation(fields: [hotmapTemplateId], references: [id])

  // å¦‚æœéƒ½ä¸ºç©ºï¼Œæ ¹æ® themeId è‡ªåŠ¨ä½¿ç”¨å¯¹åº”æ¨¡æ¿
}
```

### PlanComponent æ›´æ–°

```prisma
model PlanComponent {
  // ... ç°æœ‰å­—æ®µ ...

  // ========== çƒ­ç‚¹å›¾é…ç½® ==========
  // çƒ­ç‚¹ä½ç½®ï¼ˆç™¾åˆ†æ¯”åæ ‡ 0-1ï¼Œnull = ä¸æ˜¾ç¤ºåœ¨å›¾ä¸Šï¼‰
  hotmapX              Float?   @map("hotmap_x")
  hotmapY              Float?   @map("hotmap_y")

  // æ ‡ç­¾æ˜¾ç¤ºæ–¹å‘
  hotmapLabelPosition  String   @default("right") @map("hotmap_label_position")

  // çƒ­ç‚¹æ˜¾ç¤ºé¡ºåºï¼ˆç”¨äºåŠ¨ç”»ã€å±‚çº§ï¼‰
  hotmapOrder          Int      @default(0) @map("hotmap_order")

  updatedAt            DateTime @updatedAt @map("updated_at")
}
```

---

## ç»„ä»¶å¯è§æ€§è§„åˆ™

### å•†æˆ·èƒ½çœ‹åˆ°çš„ç»„ä»¶

```typescript
async function getVisibleComponents(merchantId: string) {
  return prisma.serviceComponent.findMany({
    where: {
      isActive: true,
      OR: [
        // å¹³å°ç»„ä»¶ï¼šå…¨éƒ¨å¯è§
        { isSystemComponent: true },
        // å•†æˆ·ç»„ä»¶ï¼šä»…è‡ªå·±åˆ›å»ºçš„å¯è§
        { merchantId: merchantId },
      ]
    },
    orderBy: [
      { isSystemComponent: 'desc' },  // å¹³å°ç»„ä»¶ä¼˜å…ˆ
      { type: 'asc' },
      { displayOrder: 'asc' },
    ]
  });
}
```

### ç»„ä»¶å‡çº§ä¸ºå¹³å°ç»„ä»¶

```typescript
// ç®¡ç†å‘˜æ“ä½œï¼šå°†å•†æˆ·ç»„ä»¶å‡çº§ä¸ºå¹³å°ç»„ä»¶
async function promoteToSystemComponent(componentId: string) {
  const component = await prisma.serviceComponent.findUnique({
    where: { id: componentId }
  });

  if (!component || component.isSystemComponent) {
    throw new Error('ç»„ä»¶ä¸å­˜åœ¨æˆ–å·²æ˜¯å¹³å°ç»„ä»¶');
  }

  return prisma.serviceComponent.update({
    where: { id: componentId },
    data: {
      isSystemComponent: true,
      promotedFromMerchantId: component.merchantId,
      promotedAt: new Date(),
      merchantId: null,  // æ¸…é™¤å•†æˆ·å…³è”
    }
  });
}
```

---

## çƒ­ç‚¹å›¾å›¾ç‰‡æ¥æº

### ä¼˜å…ˆçº§

```typescript
async function getHotmapImage(plan: RentalPlan): Promise<string | null> {
  // 1. å•†æˆ·è‡ªå®šä¹‰å›¾ç‰‡ï¼ˆæ¨èï¼‰
  if (plan.hotmapImageUrl) {
    return plan.hotmapImageUrl;
  }

  // 2. å•†æˆ·é€‰æ‹©çš„å¹³å°æ¨¡æ¿ï¼ˆå¤‡é€‰ï¼‰
  if (plan.hotmapTemplateId) {
    const template = await prisma.mapTemplate.findUnique({
      where: { id: plan.hotmapTemplateId }
    });
    return template?.imageUrl ?? null;
  }

  // 3. æ ¹æ®ä¸»é¢˜è‡ªåŠ¨é€‰æ‹©æ¨¡æ¿ï¼ˆå…œåº•ï¼‰
  if (plan.themeId) {
    const template = await prisma.mapTemplate.findFirst({
      where: { themeId: plan.themeId, isActive: true }
    });
    if (template) return template.imageUrl;
  }

  // 4. ä½¿ç”¨é»˜è®¤æ¨¡æ¿
  const defaultTemplate = await prisma.mapTemplate.findFirst({
    where: { isDefault: true, isActive: true }
  });
  return defaultTemplate?.imageUrl ?? null;
}
```

### UI å¼•å¯¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  çƒ­ç‚¹å›¾è®¾ç½®                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ğŸ“¸ ä¸Šä¼ æ‚¨çš„å’Œæœå±•ç¤ºå›¾ (æ¨è)                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚     [ç‚¹å‡»ä¸Šä¼ ] æˆ– æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„                                  â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚     å»ºè®®æ¯”ä¾‹ 2:3ï¼Œå±•ç¤ºå’Œæœæ•´ä½“æ•ˆæœ                                â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æˆ–è€… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“‹ ä½¿ç”¨å¹³å°æ¨¡æ¿                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ å¥³å£«æŒ¯è¢– â”‚ â”‚ å¥³å£«è®¿é—®â”‚ â”‚ ç”·å£«ç¾½ç»‡â”‚ â”‚  æƒ…ä¾£   â”‚                      â”‚
â”‚  â”‚  [é€‰æ‹©]  â”‚ â”‚  [é€‰æ‹©] â”‚ â”‚  [é€‰æ‹©] â”‚ â”‚ [é€‰æ‹©]  â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å•†æˆ·è‡ªå®šä¹‰ç»„ä»¶

### åˆ›å»ºæµç¨‹ï¼ˆæ— éœ€å®¡æ ¸ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ·»åŠ è‡ªå®šä¹‰ç»„ä»¶                                                [Ã—]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ç»„ä»¶åç§° *                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç‰¹åˆ¶é‡‘ç®”å‘é¥°                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  ç»„ä»¶ç±»å‹ *                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚ğŸ‘˜ å’Œæœ  â”‚ â”‚ğŸ€ é…é¥° â—â”‚ â”‚ğŸ’„ é€ å‹  â”‚ â”‚ğŸ“¸ ä½“éªŒ  â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                         â”‚
â”‚  å›¾æ ‡                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ¨  [é€‰æ‹© emoji]                                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  æè¿° (å¯é€‰)                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ çº¯æ‰‹å·¥åˆ¶ä½œçš„é‡‘ç®”å‘é¥°ï¼Œæ­é…æŒ¯è¢–æ›´æ˜¾åè´µ                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â“˜ è‡ªå®šä¹‰ç»„ä»¶ä»…æ‚¨å¯è§ï¼Œå¯åœ¨ä»»æ„å¥—é¤ä¸­ä½¿ç”¨                              â”‚
â”‚                                                                         â”‚
â”‚                                              [å–æ¶ˆ]  [åˆ›å»ºç»„ä»¶]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶åº“æ˜¾ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»„ä»¶åº“                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  ğŸ¢ å¹³å°ç»„ä»¶                         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚ ğŸ‘˜ å’Œæœ                          â”‚
â”‚  â”‚  Â· æŒ¯è¢–å’Œæœ                      â”‚
â”‚  â”‚  Â· è®¿é—®ç€                        â”‚
â”‚  â”‚  Â· å°çº¹                          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚ ğŸ€ é…é¥°                          â”‚
â”‚  â”‚  Â· å¸¯ãƒ»å¸¯ç· ã‚                    â”‚
â”‚  â”‚  Â· è‰å±¥ãƒ»è¶³è¢‹                    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚ ğŸ’„ é€ å‹                          â”‚
â”‚  â”‚  Â· å‘å‹è®¾è®¡                      â”‚
â”‚  â”‚  Â· å¦†å®¹æœåŠ¡                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                     â”‚
â”‚  â­ æˆ‘çš„ç»„ä»¶                         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚  âœ¨ ç‰¹åˆ¶é‡‘ç®”å‘é¥°          [ç¼–è¾‘] â”‚
â”‚  â”‚  ğŸŒ¸ æ¨±èŠ±ä¸»é¢˜å°ç‰©          [ç¼–è¾‘] â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚  [+ æ·»åŠ æ–°ç»„ä»¶]                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®Œæ•´ç¼–è¾‘å™¨å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¥—é¤å†…å®¹ç¼–è¾‘å™¨                                            [ä¿å­˜] [é¢„è§ˆ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ç»„ä»¶åº“                â”‚  çƒ­ç‚¹å›¾                                  â”‚  â”‚
â”‚  â”‚                       â”‚                                          â”‚  â”‚
â”‚  â”‚  ğŸ¢ å¹³å°ç»„ä»¶           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ‘˜ å’Œæœ         â”‚  â”‚  â”‚    [å•†æˆ·ä¸Šä¼ çš„å’Œæœå›¾ç‰‡]             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Â· æŒ¯è¢–å’Œæœ     â”‚  â”‚  â”‚                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Â· è®¿é—®ç€       â”‚  â”‚  â”‚    â—â”€â”€æŒ¯è¢–å’Œæœ                     â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚           â—â”€â”€ç‰¹åˆ¶å‘é¥°              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ€ é…é¥°         â”‚  â”‚  â”‚                  â—â”€â”€å¸¯             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Â· å¸¯ãƒ»å¸¯ç· ã‚   â”‚  â”‚  â”‚                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Â· è‰å±¥ãƒ»è¶³è¢‹   â”‚  â”‚  â”‚    [æ‹–æ‹½ç»„ä»¶åˆ°æ­¤å¤„]                 â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ’„ é€ å‹         â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”‚  Â· å‘å‹è®¾è®¡     â”‚  â”‚                                          â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  å·²æ·»åŠ ç»„ä»¶ï¼š                             â”‚  â”‚
â”‚  â”‚                       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â­ æˆ‘çš„ç»„ä»¶          â”‚  â”‚ ğŸ“ æ˜¾ç¤ºåœ¨å›¾ä¸Š (3)                   â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  ğŸ‘˜ æŒ¯è¢–å’Œæœ         [éšè—] [åˆ é™¤] â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  âœ¨ ç‰¹åˆ¶é‡‘ç®”å‘é¥°â”‚  â”‚  â”‚  âœ¨ ç‰¹åˆ¶å‘é¥°         [éšè—] [åˆ é™¤] â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  ğŸŒ¸ æ¨±èŠ±å°ç‰©    â”‚  â”‚  â”‚  ğŸ€ å¸¯ãƒ»å¸¯ç· ã‚      [éšè—] [åˆ é™¤] â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ [+ æ·»åŠ æ–°ç»„ä»¶]  â”‚  â”‚  â”‚ ğŸ“¦ æœªæ˜¾ç¤º (1)                       â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  ğŸ’„ å‘å‹è®¾è®¡         [æ˜¾ç¤º] [åˆ é™¤] â”‚  â”‚  â”‚
â”‚  â”‚                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API è®¾è®¡

### GET /api/service-components

è·å–å½“å‰å•†æˆ·å¯è§çš„æ‰€æœ‰ç»„ä»¶

```typescript
// Response
{
  components: ServiceComponent[],
  categories: {
    type: string,
    label: string,
    icon: string,
    components: ServiceComponent[]
  }[]
}
```

### POST /api/merchant/components

å•†æˆ·åˆ›å»ºè‡ªå®šä¹‰ç»„ä»¶ï¼ˆæ— éœ€å®¡æ ¸ï¼‰

```typescript
// Request
{
  name: string,
  type: 'KIMONO' | 'STYLING' | 'ACCESSORY' | 'EXPERIENCE',
  icon?: string,
  description?: string
}

// Response
{
  component: ServiceComponent
}
```

### PATCH /api/merchant/components/[id]

å•†æˆ·ç¼–è¾‘è‡ªå·±çš„ç»„ä»¶

### DELETE /api/merchant/components/[id]

å•†æˆ·åˆ é™¤è‡ªå·±çš„ç»„ä»¶

### POST /api/admin/components/[id]/promote

ç®¡ç†å‘˜å°†å•†æˆ·ç»„ä»¶å‡çº§ä¸ºå¹³å°ç»„ä»¶

```typescript
// Response
{
  component: ServiceComponent,
  message: 'å·²å‡çº§ä¸ºå¹³å°ç»„ä»¶'
}
```

---

## MapHotspot çš„è§’è‰²

### ä¿ç•™åŸå› 

å½“å•†æˆ·é€‰æ‹©ä½¿ç”¨å¹³å°æ¨¡æ¿æ—¶ï¼Œ`MapHotspot` æä¾›ã€Œæ¨èä½ç½®ã€å‚è€ƒã€‚

### é€‚ç”¨åœºæ™¯

| çƒ­ç‚¹å›¾æ¥æº | MapHotspot ä½œç”¨ |
|-----------|----------------|
| å•†æˆ·è‡ªå®šä¹‰å›¾ç‰‡ | âŒ ä¸é€‚ç”¨ |
| å•†æˆ·é€‰æ‹©æ¨¡æ¿ | âœ… æä¾›æ¨èä½ç½® |
| è‡ªåŠ¨ä½¿ç”¨ä¸»é¢˜æ¨¡æ¿ | âœ… æä¾›æ¨èä½ç½® |

### æ¨èä½ç½®çš„ä½¿ç”¨

```typescript
// å½“å•†æˆ·ä½¿ç”¨å¹³å°æ¨¡æ¿æ—¶ï¼Œæ˜¾ç¤ºæ¨èä½ç½®æ ‡è®°
function getPresetPositions(plan: RentalPlan) {
  // è‡ªå®šä¹‰å›¾ç‰‡ â†’ æ— æ¨èä½ç½®
  if (plan.hotmapImageUrl) {
    return [];
  }

  // è·å–æ¨¡æ¿ ID
  const templateId = plan.hotmapTemplateId ??
    await getThemeTemplateId(plan.themeId);

  if (!templateId) return [];

  // è¿”å›æ¨¡æ¿çš„é¢„è®¾çƒ­ç‚¹
  return prisma.mapHotspot.findMany({
    where: { templateId },
    include: { component: true }
  });
}
```

---

## å®ç°è®¡åˆ’

### Phase 1ï¼šæ•°æ®æ¨¡å‹ + ç»„ä»¶åº“

1. æ›´æ–° `PlanComponent` schemaï¼ˆæ·»åŠ çƒ­ç‚¹å­—æ®µï¼‰
2. æ›´æ–° `ServiceComponent` schemaï¼ˆæ·»åŠ  merchantIdï¼‰
3. æ›´æ–° `RentalPlan` schemaï¼ˆæ·»åŠ çƒ­ç‚¹å›¾å­—æ®µï¼‰
4. è¿è¡Œ migration
5. æ›´æ–° `/api/service-components` è¿”å›å•†æˆ·ç»„ä»¶

### Phase 2ï¼šæ•´åˆç¼–è¾‘å™¨

1. åˆ›å»º `IntegratedPlanEditor` ç»„ä»¶
2. å®ç°ç»„ä»¶åº“ï¼ˆå¹³å°ç»„ä»¶ + æˆ‘çš„ç»„ä»¶ï¼‰
3. å®ç°çƒ­ç‚¹å›¾ç”»å¸ƒï¼ˆæ¥æ”¶æ‹–æ‹½ + ä½ç½®ç¼–è¾‘ï¼‰
4. å®ç°ç»„ä»¶åˆ—è¡¨ï¼ˆæ˜¾ç¤º/éšè—/åˆ é™¤ï¼‰

### Phase 3ï¼šå•†æˆ·è‡ªå®šä¹‰ç»„ä»¶

1. å®ç° `POST /api/merchant/components` åˆ›å»ºç»„ä»¶
2. å®ç°ç»„ä»¶ç¼–è¾‘/åˆ é™¤
3. æ·»åŠ ã€Œ+ æ·»åŠ æ–°ç»„ä»¶ã€UI

### Phase 4ï¼šçƒ­ç‚¹å›¾å›¾ç‰‡

1. å®ç°å›¾ç‰‡ä¸Šä¼ ï¼ˆSupabase Storageï¼‰
2. å®ç°æ¨¡æ¿é€‰æ‹© UI
3. å®ç°å›¾ç‰‡é¢„è§ˆå’Œè£å‰ª

### Phase 5ï¼šç®¡ç†å‘˜åŠŸèƒ½

1. ç®¡ç†å‘˜æŸ¥çœ‹æ‰€æœ‰å•†æˆ·ç»„ä»¶
2. å®ç°ç»„ä»¶å‡çº§ä¸ºå¹³å°ç»„ä»¶åŠŸèƒ½

---

## å…³é”®è®¾è®¡æ€»ç»“

| ç‰¹æ€§ | è®¾è®¡ |
|-----|------|
| ç»„ä»¶åˆ†ç±» | å¹³å°ç»„ä»¶ / å•†æˆ·ç»„ä»¶ï¼ˆä»…ä¸¤ç§ï¼‰ |
| å•†æˆ·ç»„ä»¶å¯è§æ€§ | ä»…åˆ›å»ºè€…å¯è§ |
| å•†æˆ·ç»„ä»¶å®¡æ ¸ | æ— éœ€å®¡æ ¸ï¼Œåˆ›å»ºå³å¯ç”¨ |
| ç»„ä»¶å‡çº§ | ç®¡ç†å‘˜å¯å°†å•†æˆ·ç»„ä»¶å‡çº§ä¸ºå¹³å°ç»„ä»¶ |
| çƒ­ç‚¹å›¾å›¾ç‰‡ | æ¨èè‡ªå®šä¹‰ï¼Œå¤‡é€‰æ¨¡æ¿ |
| çƒ­ç‚¹ä½ç½® | å­˜åœ¨ PlanComponentï¼Œæ¯å¥—é¤ç‹¬ç«‹ |
| MapHotspot | ä»…å½“ä½¿ç”¨æ¨¡æ¿æ—¶æä¾›æ¨èä½ç½® |

# Service Hotmap Integration Design (v6)

## è®¾è®¡å†³ç­–

- **æ ¸å¿ƒç›®çš„**ï¼šå±•ç¤ºä¿¡æ¯å®Œæ•´æ€§ï¼ˆå¥—é¤åŒ…å«çš„æ‰€æœ‰æœåŠ¡ï¼‰
- **çƒ­ç‚¹å›¾å¯é€‰**ï¼šå•†æˆ·å¯ä»¥é€‰æ‹©ä¸åˆ›å»ºçƒ­ç‚¹å›¾ï¼Œåªé€‰æœåŠ¡ç»„ä»¶å³å¯
- **çƒ­ç‚¹å›¾å›¾ç‰‡**ï¼šåªæœ‰ä¸¤ç§æ¥æº - è‡ªå®šä¹‰ä¸Šä¼  æˆ– å¹³å°æ¨¡æ¿
- **ç»„ä»¶åˆ†ç±»**ï¼šåªæœ‰ä¸¤ç§ - å¹³å°ç»„ä»¶ / å•†æˆ·ç»„ä»¶
- **å•†æˆ·ç»„ä»¶**ï¼šæ— éœ€å®¡æ ¸ï¼Œä»…åˆ›å»ºè€…å¯ç”¨ï¼Œå…¶ä»–å•†æˆ·ä¸å¯è§
- **ç»„ä»¶å‡çº§**ï¼šç®¡ç†å‘˜å¯å°†ä¼˜ç§€å•†æˆ·ç»„ä»¶å‡çº§ä¸ºå¹³å°ç»„ä»¶
- **æ•°æ®å­˜å‚¨**ï¼šçƒ­ç‚¹ä½ç½®å­˜åœ¨ `PlanComponent` é‡Œï¼ˆæ¯ä¸ªå¥—é¤ç‹¬ç«‹ï¼‰
- **æœåŠ¡å‡çº§**ï¼šåŒç±»å‹ç»„ä»¶æ”¯æŒä»˜è´¹å‡çº§ï¼Œæé«˜å®¢å•ä»·

---

## æ ¸å¿ƒå®ä½“å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           å¹³å°å±‚ (Platform)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ServiceComponent (ç»„ä»¶åº“)                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å¹³å°ç»„ä»¶ (isSystemComponent = true)                             â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ ğŸ‘˜ æŒ¯è¢–å’Œæœ                                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ ğŸ€ å¸¯ãƒ»å¸¯ç· ã‚                                               â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ ğŸ’„ å‘å‹è®¾è®¡                                                 â”‚   â”‚
â”‚  â”‚  â””â”€â”€ ğŸ“¸ æ‘„å½±æœåŠ¡                                                 â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  å•†æˆ·ç»„ä»¶ (merchantId != null, ä»…åˆ›å»ºè€…å¯è§)                      â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ âœ¨ [å•†æˆ·A] ç‰¹åˆ¶é‡‘ç®”å‘é¥°                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ ğŸŒ¸ [å•†æˆ·B] æ¨±èŠ±ä¸»é¢˜å°ç‰©                                      â”‚   â”‚
â”‚  â”‚  â””â”€â”€ ...                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  MapTemplate (çƒ­ç‚¹å›¾æ¨¡æ¿ - å¤‡é€‰æ–¹æ¡ˆ)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å¥³å£«æŒ¯è¢–æ¨¡æ¿ / ç”·å£«ç¾½ç»‡è¢´æ¨¡æ¿ / æƒ…ä¾£æ¨¡æ¿ / ...                   â”‚   â”‚
â”‚  â”‚  (å•†æˆ·å«Œéº»çƒ¦æ—¶å¯é€‰æ‹©ä½¿ç”¨)                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           å•†æˆ·å±‚ (Merchant)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  RentalPlan (å¥—é¤)                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ çƒ­ç‚¹å›¾é…ç½® (å¯é€‰):                                                â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚ â”‚ hotmapImageUrl: å•†æˆ·ä¸Šä¼ çš„å›¾ç‰‡                               â”‚  â”‚   â”‚
â”‚  â”‚ â”‚         - æˆ– -                                               â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ hotmapTemplateId: é€‰æ‹©çš„å¹³å°æ¨¡æ¿                             â”‚  â”‚   â”‚
â”‚  â”‚ â”‚         - æˆ– -                                               â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ éƒ½ä¸ºç©º: ä¸æ˜¾ç¤ºçƒ­ç‚¹å›¾ï¼Œåªå±•ç¤ºæœåŠ¡ç»„ä»¶åˆ—è¡¨                      â”‚  â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚ PlanComponent[] (å¥—é¤ç»„ä»¶ + çƒ­ç‚¹ä½ç½®)                             â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚ â”‚ ğŸ‘˜ æŒ¯è¢–å’Œæœ (å¹³å°)    hotmapX: 0.5, hotmapY: 0.3             â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ âœ¨ ç‰¹åˆ¶å‘é¥° (å•†æˆ·è‡ªå®šä¹‰) hotmapX: 0.3, hotmapY: 0.2          â”‚  â”‚   â”‚
â”‚  â”‚ â”‚ ğŸ’„ å‘å‹è®¾è®¡ (å¹³å°)    hotmapX: null (ä¸æ˜¾ç¤ºåœ¨å›¾ä¸Š)           â”‚  â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æœåŠ¡ç»„ä»¶å‡çº§æœºåˆ¶

### è®¾è®¡ç›®æ ‡

**æé«˜å®¢å•ä»·**ï¼šè®©ç”¨æˆ·åœ¨åŸºç¡€å¥—é¤ä¸Šè¿½åŠ æ¶ˆè´¹ï¼Œè€Œä¸æ˜¯ä¸€å¼€å§‹å°±é€‰æ‹©é«˜ä»·å¥—é¤ã€‚

åˆ©ç”¨ã€Œé”šå®šæ•ˆåº”ã€+ ã€Œæ¸è¿›å¼æ‰¿è¯ºã€å¿ƒç†ï¼š
- ç”¨æˆ·å…ˆè¢«ä½ä»·å¸å¼•è¿›å…¥
- çœ‹åˆ°å…·ä½“å†…å®¹åï¼Œæ„¿æ„ä¸ºã€Œæ›´å¥½çš„ä½“éªŒã€ä»˜è´¹

### å‡çº§æ¨¡å¼ï¼šæ··åˆæ¨¡å¼

```
åŸºç¡€å¥—é¤ Â¥9,800

ğŸ’ æ¨èå‡çº§                        [ä¸€é”®å‡çº§ +Â¥10,000]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‡çº§ä¸ºè±ªåä½“éªŒï¼š                                                         â”‚
â”‚ âœ“ å°çº¹ â†’ æŒ¯è¢–                                                          â”‚
â”‚ âœ“ åŸºç¡€é€ å‹ â†’ ä¸“ä¸šé€ å‹                                                  â”‚
â”‚ âœ“ æ–°å¢ 30åˆ†é’Ÿæ‘„å½±                                                      â”‚
â”‚                                                                         â”‚
â”‚ å•ç‹¬å‡çº§éœ€ Â¥15,000ï¼Œæ‰“åŒ…èŠ‚çœ Â¥5,000                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”§ è‡ªå®šä¹‰å‡çº§
â”œâ”€ ğŸ‘˜ å’Œæœå‡çº§
â”‚     â—‹ å°çº¹ï¼ˆå½“å‰ï¼‰
â”‚     â—‹ æŒ¯è¢– +Â¥5,000
â”‚     â—‹ é«˜çº§æŒ¯è¢– +Â¥10,000
â”œâ”€ ğŸ’„ é€ å‹å‡çº§
â”‚     â—‹ åŸºç¡€é€ å‹ï¼ˆå½“å‰ï¼‰
â”‚     â—‹ ä¸“ä¸šé€ å‹ +Â¥2,000
```

**æ··åˆæ¨¡å¼ä¼˜åŠ¿**ï¼š
- ã€Œæ¨èå‡çº§åŒ…ã€ç®€åŒ–å†³ç­–ï¼Œæ‰“åŒ…æŠ˜æ‰£å¢åŠ å¸å¼•åŠ›
- ã€Œè‡ªå®šä¹‰å‡çº§ã€ä¿ç•™çµæ´»æ€§ï¼Œæ»¡è¶³ä¸ªæ€§åŒ–éœ€æ±‚

### å‡çº§å‘ç”Ÿæ—¶æœº

| æ—¶æœº | å®ç° |
|-----|------|
| **å¥—é¤è¯¦æƒ…é¡µ** | âœ… æ˜¾ç¤ºå‡çº§é€‰é¡¹ï¼Œç”¨æˆ·å†³ç­–å‰ä¿¡æ¯å……åˆ† |
| **ç»“ç®—é¡µé¢** | âœ… å†æ¬¡æé†’ï¼Œæœ€åä¸€æ¬¡è¿½åŠ é”€å”®æœºä¼š |

### å‡çº§é…ç½®æ¨¡å¼ï¼šæ··åˆæ¨¡å¼

- **å¹³å°é¢„è®¾**ï¼šæŒ‰ä¸»é¢˜æä¾›é»˜è®¤å‡çº§è·¯å¾„ï¼ˆå¦‚ã€ŒæŒ¯è¢–ä¸»é¢˜ã€çš„æ ‡å‡†å‡çº§ç»„åˆï¼‰
- **å•†æˆ·è‡ªå®šä¹‰**ï¼šå•†æˆ·å¯è°ƒæ•´å‡çº§é€‰é¡¹å’Œä»·æ ¼

```
å¹³å°é¢„è®¾çš„æŒ¯è¢–ä¸»é¢˜å‡çº§è·¯å¾„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘˜ å’Œæœå‡çº§è·¯å¾„ï¼ˆå¹³å°é¢„è®¾ï¼‰                                            â”‚
â”‚  å°çº¹ â†’ æŒ¯è¢– (+Â¥5,000) â†’ é«˜çº§æŒ¯è¢– (+Â¥10,000) â†’ é¡¶çº§æ‰‹å·¥æŒ¯è¢– (+Â¥30,000) â”‚
â”‚                                                                        â”‚
â”‚  ğŸ’„ é€ å‹å‡çº§è·¯å¾„ï¼ˆå¹³å°é¢„è®¾ï¼‰                                            â”‚
â”‚  åŸºç¡€é€ å‹ â†’ ä¸“ä¸šé€ å‹ (+Â¥2,000) â†’ æ˜æ˜Ÿé€ å‹å¸ˆ (+Â¥8,000)                  â”‚
â”‚                                                                        â”‚
â”‚  ğŸ“¸ æ‘„å½±å‡çº§è·¯å¾„ï¼ˆå¹³å°é¢„è®¾ï¼‰                                            â”‚
â”‚  æ—  â†’ 30åˆ†é’Ÿ (+Â¥8,000) â†’ 60åˆ†é’Ÿ (+Â¥15,000) â†’ åŠæ—¥è·Ÿæ‹ (+Â¥30,000)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å•†æˆ·å¯ä»¥ï¼š
âœ“ ä½¿ç”¨å¹³å°é¢„è®¾ï¼ˆçœäº‹ï¼‰
âœ“ è°ƒæ•´å‡çº§å·®ä»·ï¼ˆå¦‚æŒ¯è¢– +Â¥4,500 è€Œé Â¥5,000ï¼‰
âœ“ æ·»åŠ è‡ªå®šä¹‰å‡çº§é€‰é¡¹ï¼ˆå¦‚ã€Œå•†æˆ·ç‹¬å®¶é‡‘çº¿åˆºç»£ã€ï¼‰
âœ“ ç¦ç”¨æŸäº›å‡çº§é€‰é¡¹
```

---

## æ•°æ®æ¨¡å‹è®¾è®¡

### ServiceComponent æ›´æ–°

```prisma
model ServiceComponent {
  id              String          @id @default(cuid())
  code            String          @unique

  // åŸºæœ¬ä¿¡æ¯
  name            String
  nameJa          String?         @map("name_ja")
  nameEn          String?         @map("name_en")
  description     String?         @db.Text
  type            ComponentType   // KIMONO, STYLING, ACCESSORY, EXPERIENCE
  icon            String?

  // ========== ç»„ä»¶æ‰€æœ‰æƒ ==========
  // true = å¹³å°ç»„ä»¶ï¼ˆå…¨éƒ¨å•†æˆ·å¯è§ï¼‰
  // false = å•†æˆ·ç»„ä»¶ï¼ˆä»…åˆ›å»ºè€…å¯è§ï¼‰
  isSystemComponent  Boolean   @default(false) @map("is_system_component")

  // å•†æˆ·ç»„ä»¶çš„æ‰€æœ‰è€…ï¼ˆå¹³å°ç»„ä»¶æ­¤å­—æ®µä¸º nullï¼‰
  merchantId         String?   @map("merchant_id")
  merchant           Merchant? @relation(fields: [merchantId], references: [id], onDelete: Cascade)

  // å‡çº§è®°å½•ï¼šå•†æˆ·ç»„ä»¶è¢«å‡çº§ä¸ºå¹³å°ç»„ä»¶æ—¶ï¼Œè®°å½•åŸå•†æˆ· ID
  promotedFromMerchantId  String?   @map("promoted_from_merchant_id")
  promotedAt              DateTime? @map("promoted_at")

  // ========== å‡çº§å±‚çº§ ==========
  // åŒç±»å‹ç»„ä»¶çš„å±‚çº§ï¼ˆ0=åŸºç¡€, 1=æ ‡å‡†, 2=è±ªå, 3=é¡¶çº§ï¼‰
  tier            Int             @default(0)
  tierLabel       String?         @map("tier_label")  // "åŸºç¡€", "æ ‡å‡†", "è±ªå", "é¡¶çº§"

  // å®šä»·ä¿¡æ¯
  basePrice       Int             @default(0) @map("base_price")

  // å…ƒæ•°æ®
  displayOrder    Int             @default(0) @map("display_order")
  isActive        Boolean         @default(true) @map("is_active")
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")

  // å…³è”
  planComponents  PlanComponent[]
  mapHotspots     MapHotspot[]

  // å‡çº§å…³è”
  upgradesFrom      ComponentUpgrade[] @relation("UpgradeFrom")
  upgradesTo        ComponentUpgrade[] @relation("UpgradeTo")

  @@index([isSystemComponent, isActive])
  @@index([merchantId])
  @@index([type, tier])
  @@map("service_components")
}
```

### RentalPlan æ›´æ–°

```prisma
model RentalPlan {
  // ... ç°æœ‰å­—æ®µ ...

  // ========== çƒ­ç‚¹å›¾é…ç½®ï¼ˆå¯é€‰ï¼‰==========
  // å•†æˆ·è‡ªå®šä¹‰çƒ­ç‚¹å›¾ç‰‡
  hotmapImageUrl     String?      @map("hotmap_image_url")

  // é€‰æ‹©çš„å¹³å°æ¨¡æ¿
  hotmapTemplateId   String?      @map("hotmap_template_id")
  hotmapTemplate     MapTemplate? @relation(fields: [hotmapTemplateId], references: [id])

  // éƒ½ä¸ºç©º = ä¸æ˜¾ç¤ºçƒ­ç‚¹å›¾ï¼Œå¥—é¤è¯¦æƒ…åªå±•ç¤ºæœåŠ¡ç»„ä»¶åˆ—è¡¨
}
```

### PlanComponent æ›´æ–°

```prisma
model PlanComponent {
  // ... ç°æœ‰å­—æ®µ ...

  // ========== çƒ­ç‚¹å›¾é…ç½® ==========
  // çƒ­ç‚¹ä½ç½®ï¼ˆç™¾åˆ†æ¯”åæ ‡ 0-1ï¼Œnull = ä¸æ˜¾ç¤ºåœ¨å›¾ä¸Šï¼‰
  hotmapX              Float?   @map("hotmap_x")
  hotmapY              Float?   @map("hotmap_y")

  // æ ‡ç­¾æ˜¾ç¤ºæ–¹å‘
  hotmapLabelPosition  String   @default("right") @map("hotmap_label_position")

  // çƒ­ç‚¹æ˜¾ç¤ºé¡ºåºï¼ˆç”¨äºåŠ¨ç”»ã€å±‚çº§ï¼‰
  hotmapOrder          Int      @default(0) @map("hotmap_order")

  updatedAt            DateTime @updatedAt @map("updated_at")
}
```

### ComponentUpgradeï¼ˆç»Ÿä¸€å‡çº§é…ç½®è¡¨ï¼‰

```prisma
// ç»Ÿä¸€çš„ç»„ä»¶å‡çº§é…ç½®
// æ”¯æŒä¸¤ç§ scopeï¼šPLATFORMï¼ˆå¹³å°é¢„è®¾ï¼‰å’Œ MERCHANTï¼ˆå•†æˆ·è‡ªå®šä¹‰ï¼‰
model ComponentUpgrade {
  id                String   @id @default(cuid())

  // å‡çº§æ¥æºç»„ä»¶
  fromComponentId   String   @map("from_component_id")
  fromComponent     ServiceComponent @relation("UpgradeFrom", fields: [fromComponentId], references: [id])

  // å‡çº§ç›®æ ‡ç»„ä»¶
  toComponentId     String   @map("to_component_id")
  toComponent       ServiceComponent @relation("UpgradeTo", fields: [toComponentId], references: [id])

  // å‡çº§å·®ä»·
  priceDiff         Int      @map("price_diff")

  // ========== ä½œç”¨åŸŸ ==========
  scope             UpgradeScope  // PLATFORM | MERCHANT

  // ä½œç”¨åŸŸ IDï¼š
  // - PLATFORM: themeIdï¼ˆæŒ‰ä¸»é¢˜ï¼‰æˆ– nullï¼ˆå…¨å±€ï¼‰
  // - MERCHANT: merchantId
  scopeId           String?   @map("scope_id")

  // ========== å±•ç¤ºä¿¡æ¯ ==========
  label             String?   // "å‡çº§ä¸ºæŒ¯è¢–"
  description       String?   // "æ›´åä¸½çš„æ­£è£…ä½“éªŒ"
  isRecommended     Boolean   @default(false) @map("is_recommended")
  displayOrder      Int       @default(0) @map("display_order")
  isActive          Boolean   @default(true) @map("is_active")

  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  @@unique([fromComponentId, toComponentId, scope, scopeId])
  @@index([fromComponentId, scope, isActive])
  @@index([scopeId])
  @@map("component_upgrades")
}

enum UpgradeScope {
  PLATFORM   // å¹³å°é¢„è®¾ï¼ˆscopeId = themeId æˆ– nullï¼‰
  MERCHANT   // å•†æˆ·è‡ªå®šä¹‰ï¼ˆscopeId = merchantIdï¼‰
}
```

**æŸ¥è¯¢ä¼˜å…ˆçº§**ï¼šMERCHANT > PLATFORMï¼ˆå•†æˆ·é…ç½®è¦†ç›–å¹³å°é¢„è®¾ï¼‰

```typescript
// è·å–ç»„ä»¶çš„å¯ç”¨å‡çº§é€‰é¡¹
async function getUpgradeOptions(
  fromComponentId: string,
  merchantId: string,
  themeId?: string
) {
  // ä¸€æ¬¡æŸ¥è¯¢ï¼Œè·å–æ‰€æœ‰å¯èƒ½çš„å‡çº§é€‰é¡¹
  const upgrades = await prisma.componentUpgrade.findMany({
    where: {
      fromComponentId,
      isActive: true,
      OR: [
        // å•†æˆ·è‡ªå®šä¹‰ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
        { scope: 'MERCHANT', scopeId: merchantId },
        // å¹³å°é¢„è®¾ - ä¸»é¢˜ç‰¹å®š
        { scope: 'PLATFORM', scopeId: themeId },
        // å¹³å°é¢„è®¾ - å…¨å±€
        { scope: 'PLATFORM', scopeId: null },
      ],
    },
    include: { toComponent: true },
    orderBy: { displayOrder: 'asc' },
  });

  // å»é‡ï¼šåŒä¸€ä¸ª toComponentId åªä¿ç•™æœ€é«˜ä¼˜å…ˆçº§çš„
  // ä¼˜å…ˆçº§ï¼šMERCHANT > PLATFORM(themeId) > PLATFORM(null)
  const priorityMap = new Map<string, typeof upgrades[0]>();

  for (const upgrade of upgrades) {
    const key = upgrade.toComponentId;
    const existing = priorityMap.get(key);

    if (!existing) {
      priorityMap.set(key, upgrade);
      continue;
    }

    // æ¯”è¾ƒä¼˜å…ˆçº§
    const getPriority = (u: typeof upgrade) => {
      if (u.scope === 'MERCHANT') return 3;
      if (u.scope === 'PLATFORM' && u.scopeId === themeId) return 2;
      return 1; // PLATFORM global
    };

    if (getPriority(upgrade) > getPriority(existing)) {
      priorityMap.set(key, upgrade);
    }
  }

  return Array.from(priorityMap.values())
    .sort((a, b) => a.displayOrder - b.displayOrder);
}
```

### PlanUpgradeBundleï¼ˆå¥—é¤å‡çº§åŒ…ï¼‰

```prisma
// å¥—é¤çš„ã€Œä¸€é”®å‡çº§ã€æ‰“åŒ…æ–¹æ¡ˆ
model PlanUpgradeBundle {
  id              String   @id @default(cuid())

  // æ‰€å±å¥—é¤
  planId          String   @map("plan_id")
  plan            RentalPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  // å±•ç¤ºä¿¡æ¯
  label           String   // "è±ªåå‡çº§åŒ…"
  description     String?  // "ä¸€é”®å‡çº§ä¸ºè±ªåä½“éªŒ"

  // å‡çº§å†…å®¹ï¼ˆç»„ä»¶æ›¿æ¢æ¸…å•ï¼‰
  // JSON: [{ "fromComponentId": "xxx", "toComponentId": "yyy" }, { "addComponentId": "zzz" }]
  upgradeItems    Json     @map("upgrade_items")

  // æ‰“åŒ…ä»·æ ¼
  bundlePrice     Int      @map("bundle_price")      // æ‰“åŒ…å‡çº§ä»·
  originalPrice   Int      @map("original_price")    // å•ç‹¬å‡çº§æ€»ä»·ï¼ˆç”¨äºæ˜¾ç¤ºã€ŒèŠ‚çœ X å…ƒã€ï¼‰

  // å±•ç¤ºé…ç½®
  isRecommended   Boolean  @default(true) @map("is_recommended")
  displayOrder    Int      @default(0) @map("display_order")
  isActive        Boolean  @default(true) @map("is_active")

  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  @@index([planId, isActive])
  @@map("plan_upgrade_bundles")
}
```

---

## ç»„ä»¶å¯è§æ€§è§„åˆ™

### å•†æˆ·èƒ½çœ‹åˆ°çš„ç»„ä»¶

```typescript
async function getVisibleComponents(merchantId: string) {
  return prisma.serviceComponent.findMany({
    where: {
      isActive: true,
      OR: [
        // å¹³å°ç»„ä»¶ï¼šå…¨éƒ¨å¯è§
        { isSystemComponent: true },
        // å•†æˆ·ç»„ä»¶ï¼šä»…è‡ªå·±åˆ›å»ºçš„å¯è§
        { merchantId: merchantId },
      ]
    },
    orderBy: [
      { isSystemComponent: 'desc' },  // å¹³å°ç»„ä»¶ä¼˜å…ˆ
      { type: 'asc' },
      { displayOrder: 'asc' },
    ]
  });
}
```

### ç»„ä»¶å‡çº§ä¸ºå¹³å°ç»„ä»¶

```typescript
// ç®¡ç†å‘˜æ“ä½œï¼šå°†å•†æˆ·ç»„ä»¶å‡çº§ä¸ºå¹³å°ç»„ä»¶
async function promoteToSystemComponent(componentId: string) {
  const component = await prisma.serviceComponent.findUnique({
    where: { id: componentId }
  });

  if (!component || component.isSystemComponent) {
    throw new Error('ç»„ä»¶ä¸å­˜åœ¨æˆ–å·²æ˜¯å¹³å°ç»„ä»¶');
  }

  return prisma.serviceComponent.update({
    where: { id: componentId },
    data: {
      isSystemComponent: true,
      promotedFromMerchantId: component.merchantId,
      promotedAt: new Date(),
      merchantId: null,  // æ¸…é™¤å•†æˆ·å…³è”
    }
  });
}
```

---

## çƒ­ç‚¹å›¾å›¾ç‰‡æ¥æº

### ç®€åŒ–é€»è¾‘ï¼ˆåªæœ‰ä¸¤ç§é€‰æ‹©ï¼‰

```typescript
async function getHotmapImage(plan: RentalPlan): Promise<string | null> {
  // 1. å•†æˆ·è‡ªå®šä¹‰å›¾ç‰‡
  if (plan.hotmapImageUrl) {
    return plan.hotmapImageUrl;
  }

  // 2. å•†æˆ·é€‰æ‹©çš„å¹³å°æ¨¡æ¿
  if (plan.hotmapTemplateId) {
    const template = await prisma.mapTemplate.findUnique({
      where: { id: plan.hotmapTemplateId }
    });
    return template?.imageUrl ?? null;
  }

  // éƒ½ä¸ºç©º = ä¸æ˜¾ç¤ºçƒ­ç‚¹å›¾
  return null;
}
```

### UI å¼•å¯¼ï¼ˆå•†æˆ·ç¼–è¾‘å™¨ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  çƒ­ç‚¹å›¾è®¾ç½® (å¯é€‰)                                            [è·³è¿‡]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ğŸ“¸ ä¸Šä¼ æ‚¨çš„å’Œæœå±•ç¤ºå›¾                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚     [ç‚¹å‡»ä¸Šä¼ ] æˆ– æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„                                  â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚     å»ºè®®æ¯”ä¾‹ 2:3ï¼Œå±•ç¤ºå’Œæœæ•´ä½“æ•ˆæœ                                â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æˆ–è€… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“‹ ä½¿ç”¨å¹³å°æ¨¡æ¿                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ å¥³å£«æŒ¯è¢– â”‚ â”‚ å¥³å£«è®¿é—®â”‚ â”‚ ç”·å£«ç¾½ç»‡â”‚ â”‚  æƒ…ä¾£   â”‚                      â”‚
â”‚  â”‚  [é€‰æ‹©]  â”‚ â”‚  [é€‰æ‹©] â”‚ â”‚  [é€‰æ‹©] â”‚ â”‚ [é€‰æ‹©]  â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                         â”‚
â”‚  â“˜ è·³è¿‡æ­¤æ­¥éª¤ï¼Œå¥—é¤è¯¦æƒ…é¡µå°†åªå±•ç¤ºæœåŠ¡ç»„ä»¶åˆ—è¡¨                          â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¥—é¤è¯¦æƒ…é¡µ UI

### æœ‰çƒ­ç‚¹å›¾æ—¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è±ªåæŒ¯è¢–ä½“éªŒ                                              Â¥19,800     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚                                     â”‚                               â”‚
â”‚  â”‚    [çƒ­ç‚¹å›¾å±•ç¤ºåŒºåŸŸ]                  â”‚                               â”‚
â”‚  â”‚                                     â”‚                               â”‚
â”‚  â”‚    â—â”€â”€æŒ¯è¢–å’Œæœ                      â”‚                               â”‚
â”‚  â”‚           â—â”€â”€ç‰¹åˆ¶å‘é¥°               â”‚                               â”‚
â”‚  â”‚                  â—â”€â”€å¸¯              â”‚                               â”‚
â”‚  â”‚                                     â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                         â”‚
â”‚  å¥—é¤åŒ…å«                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ‘˜ æŒ¯è¢–å’Œæœ      ğŸ€ å¸¯ãƒ»å¸¯ç· ã‚      âœ¨ ç‰¹åˆ¶é‡‘ç®”å‘é¥°              â”‚   â”‚
â”‚  â”‚ ğŸ’„ å‘å‹è®¾è®¡      ğŸ‘  è‰å±¥ãƒ»è¶³è¢‹                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ— çƒ­ç‚¹å›¾æ—¶ï¼ˆåªå±•ç¤ºæœåŠ¡ç»„ä»¶åˆ—è¡¨ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸºç¡€æŒ¯è¢–ä½“éªŒ                                              Â¥9,800      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚                                     â”‚                               â”‚
â”‚  â”‚    [å¥—é¤å°é¢å›¾/å•†å“å›¾]               â”‚                               â”‚
â”‚  â”‚                                     â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                         â”‚
â”‚  å¥—é¤åŒ…å«                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  ğŸ‘˜ å’Œæœ                                                         â”‚   â”‚
â”‚  â”‚  â”œâ”€ æŒ¯è¢–å’Œæœ                                                     â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  ğŸ€ é…é¥°                                                         â”‚   â”‚
â”‚  â”‚  â”œâ”€ å¸¯ãƒ»å¸¯ç· ã‚                                                   â”‚   â”‚
â”‚  â”‚  â”œâ”€ è‰å±¥ãƒ»è¶³è¢‹                                                   â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  ğŸ’„ é€ å‹                                                         â”‚   â”‚
â”‚  â”‚  â”œâ”€ å‘å‹è®¾è®¡                                                     â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶æ¸²æŸ“é€»è¾‘

```typescript
function PlanDetailPage({ plan }: { plan: RentalPlanWithComponents }) {
  const hotmapImage = await getHotmapImage(plan);
  const components = plan.planComponents.filter(pc => pc.isIncluded);

  return (
    <div>
      {/* çƒ­ç‚¹å›¾ æˆ– å°é¢å›¾ */}
      {hotmapImage ? (
        <HotmapViewer
          imageUrl={hotmapImage}
          hotspots={components.filter(c => c.hotmapX !== null)}
        />
      ) : (
        <Image src={plan.imageUrl} alt={plan.name} />
      )}

      {/* æœåŠ¡ç»„ä»¶åˆ—è¡¨ï¼ˆå§‹ç»ˆå±•ç¤ºï¼‰ */}
      <ServiceComponentList components={components} />
    </div>
  );
}

function ServiceComponentList({ components }: Props) {
  // æŒ‰ç±»å‹åˆ†ç»„
  const grouped = groupBy(components, c => c.component.type);

  return (
    <div className="å¥—é¤åŒ…å«">
      <h3>å¥—é¤åŒ…å«</h3>
      {Object.entries(grouped).map(([type, items]) => (
        <div key={type}>
          <span>{getTypeIcon(type)} {getTypeLabel(type)}</span>
          <ul>
            {items.map(item => (
              <li key={item.id}>
                {item.component.icon} {item.nameOverride || item.component.name}
              </li>
            ))}
          </ul>
        </div>
      ))}
    </div>
  );
}
```

---

## æœåŠ¡å‡çº§ UI

### å¥—é¤è¯¦æƒ…é¡µå‡çº§åŒºåŸŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸºç¡€æŒ¯è¢–ä½“éªŒ                                              Â¥9,800      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  [å¥—é¤å›¾ç‰‡/çƒ­ç‚¹å›¾]                                                      â”‚
â”‚                                                                         â”‚
â”‚  å¥—é¤åŒ…å«                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ‘˜ å°çº¹å’Œæœ      ğŸ€ å¸¯ãƒ»å¸¯ç· ã‚      ğŸ’„ åŸºç¡€é€ å‹                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                         â”‚
â”‚  ğŸ’ æ¨èå‡çº§                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  ğŸŒŸ è±ªåä½“éªŒå‡çº§åŒ…                            [ä¸€é”®å‡çº§ +Â¥10,000] â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ âœ“ å°çº¹ â†’ æŒ¯è¢–å’Œæœ                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ âœ“ åŸºç¡€é€ å‹ â†’ ä¸“ä¸šé€ å‹                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ âœ“ æ–°å¢ 30åˆ†é’Ÿä¸“ä¸šæ‘„å½±                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ’° å•ç‹¬å‡çº§éœ€ Â¥15,000ï¼Œæ‰“åŒ…èŠ‚çœ Â¥5,000                     â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  ğŸ”§ è‡ªå®šä¹‰å‡çº§                                           [å±•å¼€/æ”¶èµ·]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  ğŸ‘˜ å’Œæœ                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  â—‹ å°çº¹å’Œæœï¼ˆå½“å‰ï¼‰                                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â—‹ æŒ¯è¢–å’Œæœ                                    +Â¥5,000     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â—‹ é«˜çº§æŒ¯è¢–ï¼ˆæ‰‹å·¥åˆºç»£ï¼‰                        +Â¥10,000    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â—‹ é¡¶çº§æ‰‹å·¥æŒ¯è¢–                                +Â¥30,000    â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  ğŸ’„ é€ å‹                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  â—‹ åŸºç¡€é€ å‹ï¼ˆå½“å‰ï¼‰                                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â—‹ ä¸“ä¸šé€ å‹ï¼ˆå«å‘é¥°ï¼‰                          +Â¥2,000     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â—‹ æ˜æ˜Ÿé€ å‹å¸ˆ                                  +Â¥8,000     â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  ğŸ“¸ æ‘„å½±ï¼ˆå¯é€‰æ·»åŠ ï¼‰                                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  â˜ 30åˆ†é’Ÿä¸“ä¸šæ‘„å½±                              +Â¥8,000     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â˜ 60åˆ†é’Ÿä¸“ä¸šæ‘„å½±                              +Â¥15,000    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â˜ åŠæ—¥è·Ÿæ‹                                    +Â¥30,000    â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                         â”‚
â”‚  å½“å‰ä»·æ ¼ï¼šÂ¥9,800 + å‡çº§ Â¥7,000 = Â¥16,800                              â”‚
â”‚                                                                         â”‚
â”‚                                              [åŠ å…¥è´­ç‰©è½¦]  [ç«‹å³é¢„è®¢]   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»“ç®—é¡µé¢å‡çº§æé†’

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¡®è®¤è®¢å•                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ğŸ“¦ è®¢å•å†…å®¹                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  åŸºç¡€æŒ¯è¢–ä½“éªŒ                                          Â¥9,800   â”‚   â”‚
â”‚  â”‚  â””â”€ å‡çº§ï¼šæŒ¯è¢–å’Œæœ                                    +Â¥5,000   â”‚   â”‚
â”‚  â”‚  â””â”€ å‡çº§ï¼šä¸“ä¸šé€ å‹                                    +Â¥2,000   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  ğŸ’¡ è¿˜å¯ä»¥å‡çº§                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“¸ æ·»åŠ  30åˆ†é’Ÿä¸“ä¸šæ‘„å½±                   +Â¥8,000   [æ·»åŠ ]      â”‚   â”‚
â”‚  â”‚     è®°å½•æ‚¨çš„å’Œæœä½“éªŒï¼Œä¸“ä¸šæ‘„å½±å¸ˆå…¨ç¨‹è·Ÿæ‹                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                         â”‚
â”‚  å•†å“å°è®¡ï¼šÂ¥16,800                                                      â”‚
â”‚  æœåŠ¡è´¹ï¼šÂ¥0                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  åˆè®¡ï¼šÂ¥16,800                                                          â”‚
â”‚                                                                         â”‚
â”‚                                                    [ç¡®è®¤æ”¯ä»˜]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è´­ç‰©è½¦ä¸­çš„å‡çº§å±•ç¤º

```typescript
// CartItem ç»“æ„
interface CartItem {
  type: 'PLAN';
  planId: string;
  name: string;
  basePrice: number;          // åŸºç¡€å¥—é¤ä»·æ ¼

  // å‡çº§é…ç½®
  upgrades: {
    planComponentId: string;  // åŸç»„ä»¶
    targetComponentId: string; // å‡çº§ç›®æ ‡
    priceDiff: number;        // å‡çº§å·®ä»·
    label: string;            // "æŒ¯è¢–å’Œæœ"
  }[];

  // æ–°å¢ç»„ä»¶ï¼ˆå¦‚æ‘„å½±ï¼‰
  addons: {
    componentId: string;
    price: number;
    label: string;
  }[];

  // è®¡ç®—å±æ€§
  totalPrice: number;  // basePrice + sum(upgrades) + sum(addons)
}
```

### å‡çº§é€‰æ‹©é€»è¾‘

å‡çº§æŸ¥è¯¢é€»è¾‘å·²åœ¨ `ComponentUpgrade` æ¨¡å‹å®šä¹‰å¤„è¯´æ˜ã€‚

```typescript
// è·å–å¥—é¤çš„æ¨èå‡çº§åŒ…
async function getUpgradeBundles(planId: string) {
  return prisma.planUpgradeBundle.findMany({
    where: {
      planId,
      isActive: true,
    },
    orderBy: [
      { isRecommended: 'desc' },
      { displayOrder: 'asc' },
    ],
  });
}
```

---

## å•†æˆ·å‡çº§é…ç½® UI

### å¥—é¤ç¼–è¾‘å™¨ä¸­çš„å‡çº§é…ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¥—é¤å†…å®¹ç¼–è¾‘å™¨                                            [ä¿å­˜] [é¢„è§ˆ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ğŸ‘˜ å’Œæœ                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å½“å‰é…ç½®ï¼šå°çº¹å’Œæœ                                              â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  å‡çº§é€‰é¡¹ï¼š                                      [+ æ·»åŠ å‡çº§é€‰é¡¹] â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ â˜‘ ä½¿ç”¨å¹³å°é¢„è®¾                                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   Â· æŒ¯è¢–å’Œæœ      å¹³å°å»ºè®® +Â¥5,000    [è‡ªå®šä¹‰ä»·æ ¼: Â¥    ]   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   Â· é«˜çº§æŒ¯è¢–      å¹³å°å»ºè®® +Â¥10,000   [è‡ªå®šä¹‰ä»·æ ¼: Â¥    ]   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   Â· é¡¶çº§æ‰‹å·¥æŒ¯è¢–  å¹³å°å»ºè®® +Â¥30,000   [è‡ªå®šä¹‰ä»·æ ¼: Â¥    ]   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ å•†æˆ·è‡ªå®šä¹‰å‡çº§                                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   Â· å•†æˆ·ç‹¬å®¶é‡‘çº¿åˆºç»£æŒ¯è¢–  +Â¥25,000              [Ã—åˆ é™¤]    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   [+ æ·»åŠ è‡ªå®šä¹‰å‡çº§]                                        â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  ğŸ“¸ æ‘„å½±ï¼ˆå¯æ·»åŠ é¡¹ï¼‰                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å½“å‰é…ç½®ï¼šä¸åŒ…å«æ‘„å½±                                            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  å¯é€‰æ·»åŠ ï¼š                                                      â”‚   â”‚
â”‚  â”‚  â˜‘ 30åˆ†é’Ÿä¸“ä¸šæ‘„å½±    å¹³å°å»ºè®® +Â¥8,000    [è‡ªå®šä¹‰ä»·æ ¼: Â¥8,000 ]  â”‚   â”‚
â”‚  â”‚  â˜‘ 60åˆ†é’Ÿä¸“ä¸šæ‘„å½±    å¹³å°å»ºè®® +Â¥15,000   [è‡ªå®šä¹‰ä»·æ ¼: Â¥15,000]  â”‚   â”‚
â”‚  â”‚  â˜ åŠæ—¥è·Ÿæ‹          å¹³å°å»ºè®® +Â¥30,000   [ç¦ç”¨æ­¤é€‰é¡¹]           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                         â”‚
â”‚  ğŸ’ å‡çº§åŒ…é…ç½®                                          [+ æ·»åŠ å‡çº§åŒ…] â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸŒŸ è±ªåä½“éªŒå‡çº§åŒ…                                   [ç¼–è¾‘] [Ã—] â”‚   â”‚
â”‚  â”‚  åŒ…å«ï¼šæŒ¯è¢– + ä¸“ä¸šé€ å‹ + 30åˆ†é’Ÿæ‘„å½±                             â”‚   â”‚
â”‚  â”‚  æ‰“åŒ…ä»·ï¼šÂ¥10,000ï¼ˆåŸä»· Â¥15,000ï¼ŒèŠ‚çœ Â¥5,000ï¼‰                   â”‚   â”‚
â”‚  â”‚  â˜‘ è®¾ä¸ºæ¨è                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å•†æˆ·è‡ªå®šä¹‰ç»„ä»¶

### åˆ›å»ºæµç¨‹ï¼ˆæ— éœ€å®¡æ ¸ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ·»åŠ è‡ªå®šä¹‰ç»„ä»¶                                                [Ã—]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ç»„ä»¶åç§° *                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç‰¹åˆ¶é‡‘ç®”å‘é¥°                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  ç»„ä»¶ç±»å‹ *                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚ğŸ‘˜ å’Œæœ  â”‚ â”‚ğŸ€ é…é¥° â—â”‚ â”‚ğŸ’„ é€ å‹  â”‚ â”‚ğŸ“¸ ä½“éªŒ  â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                         â”‚
â”‚  å›¾æ ‡                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ¨  [é€‰æ‹© emoji]                                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  æè¿° (å¯é€‰)                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ çº¯æ‰‹å·¥åˆ¶ä½œçš„é‡‘ç®”å‘é¥°ï¼Œæ­é…æŒ¯è¢–æ›´æ˜¾åè´µ                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â“˜ è‡ªå®šä¹‰ç»„ä»¶ä»…æ‚¨å¯è§ï¼Œå¯åœ¨ä»»æ„å¥—é¤ä¸­ä½¿ç”¨                              â”‚
â”‚                                                                         â”‚
â”‚                                              [å–æ¶ˆ]  [åˆ›å»ºç»„ä»¶]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶åº“æ˜¾ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»„ä»¶åº“                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  ğŸ¢ å¹³å°ç»„ä»¶                         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚ ğŸ‘˜ å’Œæœ                          â”‚
â”‚  â”‚  Â· æŒ¯è¢–å’Œæœ                      â”‚
â”‚  â”‚  Â· è®¿é—®ç€                        â”‚
â”‚  â”‚  Â· å°çº¹                          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚ ğŸ€ é…é¥°                          â”‚
â”‚  â”‚  Â· å¸¯ãƒ»å¸¯ç· ã‚                    â”‚
â”‚  â”‚  Â· è‰å±¥ãƒ»è¶³è¢‹                    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚ ğŸ’„ é€ å‹                          â”‚
â”‚  â”‚  Â· å‘å‹è®¾è®¡                      â”‚
â”‚  â”‚  Â· å¦†å®¹æœåŠ¡                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                     â”‚
â”‚  â­ æˆ‘çš„ç»„ä»¶                         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚  âœ¨ ç‰¹åˆ¶é‡‘ç®”å‘é¥°          [ç¼–è¾‘] â”‚
â”‚  â”‚  ğŸŒ¸ æ¨±èŠ±ä¸»é¢˜å°ç‰©          [ç¼–è¾‘] â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚  [+ æ·»åŠ æ–°ç»„ä»¶]                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®Œæ•´ç¼–è¾‘å™¨å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¥—é¤å†…å®¹ç¼–è¾‘å™¨                                            [ä¿å­˜] [é¢„è§ˆ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ç»„ä»¶åº“                â”‚  çƒ­ç‚¹å›¾                                  â”‚  â”‚
â”‚  â”‚                       â”‚                                          â”‚  â”‚
â”‚  â”‚  ğŸ¢ å¹³å°ç»„ä»¶           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ‘˜ å’Œæœ         â”‚  â”‚  â”‚    [å•†æˆ·ä¸Šä¼ çš„å’Œæœå›¾ç‰‡]             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Â· æŒ¯è¢–å’Œæœ     â”‚  â”‚  â”‚                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Â· è®¿é—®ç€       â”‚  â”‚  â”‚    â—â”€â”€æŒ¯è¢–å’Œæœ                     â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚           â—â”€â”€ç‰¹åˆ¶å‘é¥°              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ€ é…é¥°         â”‚  â”‚  â”‚                  â—â”€â”€å¸¯             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Â· å¸¯ãƒ»å¸¯ç· ã‚   â”‚  â”‚  â”‚                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Â· è‰å±¥ãƒ»è¶³è¢‹   â”‚  â”‚  â”‚    [æ‹–æ‹½ç»„ä»¶åˆ°æ­¤å¤„]                 â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ’„ é€ å‹         â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”‚  Â· å‘å‹è®¾è®¡     â”‚  â”‚                                          â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  å·²æ·»åŠ ç»„ä»¶ï¼š                             â”‚  â”‚
â”‚  â”‚                       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â­ æˆ‘çš„ç»„ä»¶          â”‚  â”‚ ğŸ“ æ˜¾ç¤ºåœ¨å›¾ä¸Š (3)                   â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  ğŸ‘˜ æŒ¯è¢–å’Œæœ         [éšè—] [åˆ é™¤] â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  âœ¨ ç‰¹åˆ¶é‡‘ç®”å‘é¥°â”‚  â”‚  â”‚  âœ¨ ç‰¹åˆ¶å‘é¥°         [éšè—] [åˆ é™¤] â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  ğŸŒ¸ æ¨±èŠ±å°ç‰©    â”‚  â”‚  â”‚  ğŸ€ å¸¯ãƒ»å¸¯ç· ã‚      [éšè—] [åˆ é™¤] â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ [+ æ·»åŠ æ–°ç»„ä»¶]  â”‚  â”‚  â”‚ ğŸ“¦ æœªæ˜¾ç¤º (1)                       â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  ğŸ’„ å‘å‹è®¾è®¡         [æ˜¾ç¤º] [åˆ é™¤] â”‚  â”‚  â”‚
â”‚  â”‚                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API è®¾è®¡

### GET /api/service-components

è·å–å½“å‰å•†æˆ·å¯è§çš„æ‰€æœ‰ç»„ä»¶

```typescript
// Response
{
  components: ServiceComponent[],
  categories: {
    type: string,
    label: string,
    icon: string,
    components: ServiceComponent[]
  }[]
}
```

### POST /api/merchant/components

å•†æˆ·åˆ›å»ºè‡ªå®šä¹‰ç»„ä»¶ï¼ˆæ— éœ€å®¡æ ¸ï¼‰

```typescript
// Request
{
  name: string,
  type: 'KIMONO' | 'STYLING' | 'ACCESSORY' | 'EXPERIENCE',
  icon?: string,
  description?: string
}

// Response
{
  component: ServiceComponent
}
```

### PATCH /api/merchant/components/[id]

å•†æˆ·ç¼–è¾‘è‡ªå·±çš„ç»„ä»¶

### DELETE /api/merchant/components/[id]

å•†æˆ·åˆ é™¤è‡ªå·±çš„ç»„ä»¶

### POST /api/admin/components/[id]/promote

ç®¡ç†å‘˜å°†å•†æˆ·ç»„ä»¶å‡çº§ä¸ºå¹³å°ç»„ä»¶

```typescript
// Response
{
  component: ServiceComponent,
  message: 'å·²å‡çº§ä¸ºå¹³å°ç»„ä»¶'
}
```

---

## MapHotspot çš„è§’è‰²

### ä¿ç•™åŸå› 

å½“å•†æˆ·é€‰æ‹©ä½¿ç”¨å¹³å°æ¨¡æ¿æ—¶ï¼Œ`MapHotspot` æä¾›ã€Œæ¨èä½ç½®ã€å‚è€ƒã€‚

### é€‚ç”¨åœºæ™¯

| çƒ­ç‚¹å›¾æ¥æº | MapHotspot ä½œç”¨ |
|-----------|----------------|
| å•†æˆ·è‡ªå®šä¹‰å›¾ç‰‡ | âŒ ä¸é€‚ç”¨ |
| å•†æˆ·é€‰æ‹©æ¨¡æ¿ | âœ… æä¾›æ¨èä½ç½® |
| è‡ªåŠ¨ä½¿ç”¨ä¸»é¢˜æ¨¡æ¿ | âœ… æä¾›æ¨èä½ç½® |

### æ¨èä½ç½®çš„ä½¿ç”¨

```typescript
// å½“å•†æˆ·ä½¿ç”¨å¹³å°æ¨¡æ¿æ—¶ï¼Œæ˜¾ç¤ºæ¨èä½ç½®æ ‡è®°
function getPresetPositions(plan: RentalPlan) {
  // è‡ªå®šä¹‰å›¾ç‰‡ â†’ æ— æ¨èä½ç½®
  if (plan.hotmapImageUrl) {
    return [];
  }

  // è·å–æ¨¡æ¿ ID
  const templateId = plan.hotmapTemplateId ??
    await getThemeTemplateId(plan.themeId);

  if (!templateId) return [];

  // è¿”å›æ¨¡æ¿çš„é¢„è®¾çƒ­ç‚¹
  return prisma.mapHotspot.findMany({
    where: { templateId },
    include: { component: true }
  });
}
```

---

## å®ç°è®¡åˆ’

### Phase 1ï¼šæ•°æ®æ¨¡å‹ + ç»„ä»¶åº“

1. æ›´æ–° `PlanComponent` schemaï¼ˆæ·»åŠ çƒ­ç‚¹å­—æ®µï¼‰
2. æ›´æ–° `ServiceComponent` schemaï¼ˆæ·»åŠ  merchantIdã€tierï¼‰
3. æ›´æ–° `RentalPlan` schemaï¼ˆæ·»åŠ çƒ­ç‚¹å›¾å­—æ®µï¼‰
4. æ–°å¢ `ComponentUpgrade` schemaï¼ˆç»Ÿä¸€å‡çº§é…ç½®è¡¨ï¼Œæ”¯æŒ PLATFORM/MERCHANT ä¸¤ç§ scopeï¼‰
5. æ–°å¢ `PlanUpgradeBundle` schemaï¼ˆå¥—é¤å‡çº§åŒ…ï¼‰
6. è¿è¡Œ migration
7. æ›´æ–° `/api/service-components` è¿”å›å•†æˆ·ç»„ä»¶

### Phase 2ï¼šæ•´åˆç¼–è¾‘å™¨

1. åˆ›å»º `IntegratedPlanEditor` ç»„ä»¶
2. å®ç°ç»„ä»¶åº“ï¼ˆå¹³å°ç»„ä»¶ + æˆ‘çš„ç»„ä»¶ï¼‰
3. å®ç°çƒ­ç‚¹å›¾ç”»å¸ƒï¼ˆæ¥æ”¶æ‹–æ‹½ + ä½ç½®ç¼–è¾‘ï¼‰
4. å®ç°ç»„ä»¶åˆ—è¡¨ï¼ˆæ˜¾ç¤º/éšè—/åˆ é™¤ï¼‰

### Phase 3ï¼šå•†æˆ·è‡ªå®šä¹‰ç»„ä»¶

1. å®ç° `POST /api/merchant/components` åˆ›å»ºç»„ä»¶
2. å®ç°ç»„ä»¶ç¼–è¾‘/åˆ é™¤
3. æ·»åŠ ã€Œ+ æ·»åŠ æ–°ç»„ä»¶ã€UI

### Phase 4ï¼šçƒ­ç‚¹å›¾å›¾ç‰‡

1. å®ç°å›¾ç‰‡ä¸Šä¼ ï¼ˆSupabase Storageï¼‰
2. å®ç°æ¨¡æ¿é€‰æ‹© UI
3. å®ç°å›¾ç‰‡é¢„è§ˆå’Œè£å‰ª

### Phase 5ï¼šæœåŠ¡å‡çº§åŠŸèƒ½ï¼ˆç”¨æˆ·ç«¯ï¼‰

1. å¥—é¤è¯¦æƒ…é¡µï¼šå‡çº§é€‰é¡¹å±•ç¤º
   - æ¨èå‡çº§åŒ…ï¼ˆä¸€é”®å‡çº§ï¼‰
   - è‡ªå®šä¹‰å‡çº§ï¼ˆæŒ‰ç»„ä»¶é€‰æ‹©ï¼‰
2. è´­ç‰©è½¦ï¼šå‡çº§çŠ¶æ€å­˜å‚¨å’Œå±•ç¤º
3. ç»“ç®—é¡µï¼šè¿½åŠ é”€å”®æé†’

### Phase 6ï¼šå‡çº§é…ç½®ï¼ˆå•†æˆ·ç«¯ï¼‰

1. å•†æˆ·ç¼–è¾‘å™¨ï¼šå‡çº§é€‰é¡¹é…ç½®
   - ä½¿ç”¨å¹³å°é¢„è®¾ / è‡ªå®šä¹‰ä»·æ ¼
   - æ·»åŠ å•†æˆ·ç‹¬å®¶å‡çº§é€‰é¡¹
2. å‡çº§åŒ…é…ç½®
   - åˆ›å»ºæ‰“åŒ…å‡çº§æ–¹æ¡ˆ
   - è®¾ç½®æ‰“åŒ…æŠ˜æ‰£

### Phase 7ï¼šå¹³å°ç®¡ç†

1. ç®¡ç†å‘˜æŸ¥çœ‹æ‰€æœ‰å•†æˆ·ç»„ä»¶
2. å®ç°ç»„ä»¶å‡çº§ä¸ºå¹³å°ç»„ä»¶åŠŸèƒ½
3. ç®¡ç†å¹³å°é¢„è®¾å‡çº§è·¯å¾„ï¼ˆComponentUpgradePathï¼‰
4. æŒ‰ä¸»é¢˜é…ç½®é»˜è®¤å‡çº§è·¯å¾„

---

## å…³é”®è®¾è®¡æ€»ç»“

| ç‰¹æ€§ | è®¾è®¡ |
|-----|------|
| ç»„ä»¶åˆ†ç±» | å¹³å°ç»„ä»¶ / å•†æˆ·ç»„ä»¶ï¼ˆä»…ä¸¤ç§ï¼‰ |
| å•†æˆ·ç»„ä»¶å¯è§æ€§ | ä»…åˆ›å»ºè€…å¯è§ |
| å•†æˆ·ç»„ä»¶å®¡æ ¸ | æ— éœ€å®¡æ ¸ï¼Œåˆ›å»ºå³å¯ç”¨ |
| ç»„ä»¶å‡çº§ | ç®¡ç†å‘˜å¯å°†å•†æˆ·ç»„ä»¶å‡çº§ä¸ºå¹³å°ç»„ä»¶ |
| çƒ­ç‚¹å›¾ | **å¯é€‰**ï¼Œå•†æˆ·å¯ä»¥ä¸åˆ›å»ºçƒ­ç‚¹å›¾ |
| çƒ­ç‚¹å›¾æ¥æº | ä»…ä¸¤ç§ï¼šè‡ªå®šä¹‰ä¸Šä¼  æˆ– å¹³å°æ¨¡æ¿ |
| æ— çƒ­ç‚¹å›¾æ—¶ | å¥—é¤è¯¦æƒ…åªå±•ç¤ºæœåŠ¡ç»„ä»¶åˆ—è¡¨ |
| çƒ­ç‚¹ä½ç½® | å­˜åœ¨ PlanComponentï¼Œæ¯å¥—é¤ç‹¬ç«‹ |
| MapHotspot | ä»…å½“ä½¿ç”¨æ¨¡æ¿æ—¶æä¾›æ¨èä½ç½® |
| **æœåŠ¡å‡çº§** | æ··åˆæ¨¡å¼ï¼šæ¨èå‡çº§åŒ… + è‡ªå®šä¹‰å‡çº§ |
| **å‡çº§é…ç½®** | æ··åˆæ¨¡å¼ï¼šå¹³å°é¢„è®¾ + å•†æˆ·è‡ªå®šä¹‰ |
| **å‡çº§æ—¶æœº** | å¥—é¤è¯¦æƒ…é¡µ + ç»“ç®—é¡µé¢ |
| **å‡çº§å­˜å‚¨** | `ComponentUpgrade` ç»Ÿä¸€è¡¨ï¼ˆscope: PLATFORM / MERCHANTï¼‰|

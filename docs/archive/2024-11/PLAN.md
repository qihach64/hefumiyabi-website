# æœåŠ¡ç»„ä»¶ä¸å‡çº§åŠŸèƒ½å®æ–½è®¡åˆ’

## å½“å‰çŠ¶æ€åˆ†æ

### å·²æœ‰åŸºç¡€è®¾æ–½
- âœ… `ServiceComponent` æ¨¡å‹ï¼ˆå·²æœ‰ type, tier, upgradeFromId ç­‰å­—æ®µï¼‰
- âœ… `PlanComponent` å…³è”è¡¨ï¼ˆå·²æœ‰ tier, tierLabel, customNote ç­‰å­—æ®µï¼‰
- âœ… `ServiceComponentSelector` ç»„ä»¶ï¼ˆåŸºç¡€çš„å¤šé€‰å™¨ï¼‰
- âœ… `PlanEditForm` / `PlanCreateForm` è¡¨å•ç»„ä»¶
- âœ… API è·¯ç”±æ”¯æŒ `componentIds` å’Œ `planComponents` ä¸¤ç§æ¨¡å¼

### éœ€è¦æ–°å¢
- âŒ `ComponentUpgrade` è¡¨ï¼ˆç»Ÿä¸€å‡çº§é…ç½®ï¼‰
- âŒ `PlanUpgradeBundle` è¡¨ï¼ˆå¥—é¤å‡çº§åŒ…ï¼‰
- âŒ ServiceComponent çš„ `merchantId`, `isSystemComponent` å­—æ®µ
- âŒ PlanComponent çš„ `hotmapX/Y` çƒ­ç‚¹å­—æ®µ
- âŒ å‡çº§é€‰é¡¹é…ç½® UI
- âŒ å•†æˆ·è‡ªå®šä¹‰ç»„ä»¶åŠŸèƒ½

---

## å®æ–½é˜¶æ®µ

### Phase 1: æ•°æ®æ¨¡å‹æ›´æ–° (Day 1)

**ç›®æ ‡**ï¼šæ›´æ–° Prisma Schemaï¼Œæ”¯æŒç»„ä»¶å‡çº§å’Œå•†æˆ·è‡ªå®šä¹‰ç»„ä»¶

#### 1.1 æ›´æ–° ServiceComponent
```prisma
model ServiceComponent {
  // æ–°å¢å­—æ®µ
  isSystemComponent       Boolean   @default(true)  // true=å¹³å°ç»„ä»¶, false=å•†æˆ·ç»„ä»¶
  merchantId              String?                    // å•†æˆ·ç»„ä»¶çš„æ‰€æœ‰è€…
  promotedFromMerchantId  String?                    // å‡çº§ä¸ºå¹³å°ç»„ä»¶æ—¶è®°å½•åŸå•†æˆ·
  promotedAt              DateTime?
}
```

#### 1.2 æ–°å¢ ComponentUpgrade
```prisma
model ComponentUpgrade {
  id                String   @id @default(cuid())
  fromComponentId   String
  toComponentId     String
  priceDiff         Int
  scope             UpgradeScope  // PLATFORM | MERCHANT
  scopeId           String?       // themeId æˆ– merchantId
  label             String?
  description       String?
  isRecommended     Boolean  @default(false)
  displayOrder      Int      @default(0)
  isActive          Boolean  @default(true)
}

enum UpgradeScope {
  PLATFORM
  MERCHANT
}
```

#### 1.3 æ–°å¢ PlanUpgradeBundle
```prisma
model PlanUpgradeBundle {
  id            String   @id @default(cuid())
  planId        String
  label         String
  description   String?
  upgradeItems  Json
  bundlePrice   Int
  originalPrice Int
  isRecommended Boolean  @default(true)
  displayOrder  Int      @default(0)
  isActive      Boolean  @default(true)
}
```

#### 1.4 æ›´æ–° PlanComponentï¼ˆçƒ­ç‚¹å­—æ®µï¼‰
```prisma
model PlanComponent {
  // æ–°å¢å­—æ®µ
  hotmapX              Float?
  hotmapY              Float?
  hotmapLabelPosition  String   @default("right")
  hotmapOrder          Int      @default(0)
}
```

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ›´æ–° `prisma/schema.prisma`
- [ ] è¿è¡Œ `prisma migrate dev`
- [ ] éªŒè¯ migration æˆåŠŸ

---

### Phase 2: å¢å¼º ServiceComponentSelector (Day 2-3)

**ç›®æ ‡**ï¼šæ”¹è¿›ç»„ä»¶é€‰æ‹©å™¨ï¼Œæ”¯æŒå‡çº§é€‰é¡¹é…ç½®

#### 2.1 å½“å‰ ServiceComponentSelector åŠŸèƒ½
- æŒ‰ç±»å‹åˆ†ç»„å±•ç¤ºç»„ä»¶
- å‹¾é€‰/å–æ¶ˆç»„ä»¶
- æ˜¾ç¤ºç»„ä»¶å›¾æ ‡å’Œåç§°

#### 2.2 éœ€è¦å¢å¼ºçš„åŠŸèƒ½

**UI ç»“æ„**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¥—é¤åŒ…å«å†…å®¹                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ‘˜ å’Œæœ                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â˜‘ å°çº¹å’Œæœ                              [é…ç½®å‡çº§ â–¼]â”‚   â”‚
â”‚  â”‚   å‡çº§é€‰é¡¹ï¼šæŒ¯è¢– +Â¥5,000 | é«˜çº§æŒ¯è¢– +Â¥10,000        â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚ â˜ æŒ¯è¢–å’Œæœ                                          â”‚   â”‚
â”‚  â”‚ â˜ è®¿é—®ç€                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  ğŸ€ é…é¥°                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â˜‘ å¸¯ãƒ»å¸¯ç· ã‚                            [é…ç½®å‡çº§ â–¼]â”‚   â”‚
â”‚  â”‚ â˜‘ è‰å±¥ãƒ»è¶³è¢‹                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  ğŸ’„ é€ å‹                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â˜‘ åŸºç¡€å‘å‹                              [é…ç½®å‡çº§ â–¼]â”‚   â”‚
â”‚  â”‚   å‡çº§é€‰é¡¹ï¼šä¸“ä¸šé€ å‹ +Â¥2,000                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  ğŸ“¸ ä½“éªŒ                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â˜ 30åˆ†é’Ÿæ‘„å½± (+Â¥8,000 å¯é€‰æ·»åŠ )                      â”‚   â”‚
â”‚  â”‚ â˜ 60åˆ†é’Ÿæ‘„å½± (+Â¥15,000 å¯é€‰æ·»åŠ )                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»º `ComponentUpgradeConfig` å­ç»„ä»¶ï¼ˆé…ç½®å‡çº§é€‰é¡¹å¼¹çª—ï¼‰
- [ ] ä¿®æ”¹ `ServiceComponentSelector` æ”¯æŒå‡çº§é…ç½®
- [ ] æ›´æ–°ç»„ä»¶é€‰æ‹©åçš„æ•°æ®ç»“æ„ï¼ŒåŒ…å«å‡çº§ä¿¡æ¯
- [ ] æ·»åŠ ã€Œä½¿ç”¨å¹³å°é¢„è®¾ã€å¼€å…³

---

### Phase 3: API æ”¯æŒå‡çº§é…ç½® (Day 3-4)

**ç›®æ ‡**ï¼šæ›´æ–° API ä»¥å­˜å‚¨å’ŒæŸ¥è¯¢å‡çº§é…ç½®

#### 3.1 GET /api/service-components å¢å¼º
è¿”å›ç»„ä»¶æ—¶åŒ…å«å¹³å°é¢„è®¾çš„å‡çº§è·¯å¾„ï¼š
```typescript
{
  components: ServiceComponent[],
  upgradePaths: {
    [fromComponentId: string]: ComponentUpgrade[]
  }
}
```

#### 3.2 GET /api/merchant/upgrade-config
è·å–å•†æˆ·è‡ªå®šä¹‰çš„å‡çº§é…ç½®ï¼š
```typescript
// Request
GET /api/merchant/upgrade-config?merchantId=xxx

// Response
{
  merchantUpgrades: ComponentUpgrade[],  // scope=MERCHANT
}
```

#### 3.3 POST /api/merchant/upgrade-config
å•†æˆ·åˆ›å»º/æ›´æ–°å‡çº§é…ç½®ï¼š
```typescript
// Request
{
  fromComponentId: string,
  toComponentId: string,
  priceDiff: number,
  label?: string,
  isRecommended?: boolean
}
```

#### 3.4 æ›´æ–° PATCH /api/merchant/plans/[id]
æ”¯æŒä¿å­˜å‡çº§é…ç½®åˆ° PlanUpgradeBundleï¼š
```typescript
// Request æ–°å¢å­—æ®µ
{
  // ... ç°æœ‰å­—æ®µ
  upgradeBundles?: {
    label: string,
    upgradeItems: { fromComponentId: string, toComponentId: string }[],
    bundlePrice: number,
    isRecommended?: boolean
  }[]
}
```

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ›´æ–° `GET /api/service-components` è¿”å›å‡çº§è·¯å¾„
- [ ] åˆ›å»º `GET/POST /api/merchant/upgrade-config`
- [ ] æ›´æ–° `PATCH /api/merchant/plans/[id]` æ”¯æŒå‡çº§åŒ…

---

### Phase 4: å‡çº§åŒ…é…ç½® UI (Day 4-5)

**ç›®æ ‡**ï¼šåœ¨å¥—é¤ç¼–è¾‘é¡µé¢æ·»åŠ å‡çº§åŒ…é…ç½®

#### 4.1 å‡çº§åŒ…é…ç½®åŒºåŸŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’ å‡çº§åŒ…é…ç½®                              [+ æ·»åŠ å‡çº§åŒ…]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸŒŸ è±ªåä½“éªŒå‡çº§åŒ…                        [ç¼–è¾‘] [Ã—]  â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚ åŒ…å«å‡çº§ï¼š                                          â”‚   â”‚
â”‚  â”‚ Â· å°çº¹ â†’ æŒ¯è¢–                                       â”‚   â”‚
â”‚  â”‚ Â· åŸºç¡€å‘å‹ â†’ ä¸“ä¸šé€ å‹                               â”‚   â”‚
â”‚  â”‚ Â· æ–°å¢ 30åˆ†é’Ÿæ‘„å½±                                   â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚ æ‰“åŒ…ä»·ï¼šÂ¥10,000ï¼ˆåŸä»· Â¥15,000ï¼ŒèŠ‚çœ Â¥5,000ï¼‰       â”‚   â”‚
â”‚  â”‚ â˜‘ è®¾ä¸ºæ¨è                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»º `UpgradeBundleEditor` ç»„ä»¶
- [ ] åˆ›å»º `UpgradeBundleForm` å¼¹çª—ï¼ˆæ·»åŠ /ç¼–è¾‘å‡çº§åŒ…ï¼‰
- [ ] é›†æˆåˆ° `PlanEditForm`

---

### Phase 5: ç”¨æˆ·ç«¯å‡çº§å±•ç¤º (Day 6-7)

**ç›®æ ‡**ï¼šåœ¨å¥—é¤è¯¦æƒ…é¡µå±•ç¤ºå‡çº§é€‰é¡¹

#### 5.1 å¥—é¤è¯¦æƒ…é¡µå‡çº§åŒºåŸŸ
- æ¨èå‡çº§åŒ…ï¼ˆä¸€é”®å‡çº§ï¼‰
- è‡ªå®šä¹‰å‡çº§ï¼ˆæŒ‰ç»„ä»¶é€‰æ‹©ï¼‰
- å®æ—¶ä»·æ ¼è®¡ç®—

#### 5.2 è´­ç‰©è½¦æ”¯æŒå‡çº§
- CartItem å­˜å‚¨å‡çº§é€‰æ‹©
- æ˜¾ç¤ºã€ŒåŸºç¡€å¥—é¤ + å‡çº§ã€

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»º `PlanUpgradeSection` ç»„ä»¶
- [ ] æ›´æ–° `cart.ts` æ”¯æŒå‡çº§æ•°æ®
- [ ] æ›´æ–°è´­ç‰©è½¦ UI æ˜¾ç¤ºå‡çº§

---

### Phase 6: å•†æˆ·è‡ªå®šä¹‰ç»„ä»¶ (Day 8-9)

**ç›®æ ‡**ï¼šå…è®¸å•†æˆ·åˆ›å»ºè‡ªå·±çš„æœåŠ¡ç»„ä»¶

#### 6.1 å•†æˆ·ç»„ä»¶ç®¡ç†é¡µé¢
- æŸ¥çœ‹æˆ‘çš„ç»„ä»¶åˆ—è¡¨
- åˆ›å»ºæ–°ç»„ä»¶
- ç¼–è¾‘/åˆ é™¤ç»„ä»¶

#### 6.2 API è·¯ç”±
- `GET /api/merchant/components` - è·å–å•†æˆ·ç»„ä»¶
- `POST /api/merchant/components` - åˆ›å»ºç»„ä»¶
- `PATCH /api/merchant/components/[id]` - æ›´æ–°ç»„ä»¶
- `DELETE /api/merchant/components/[id]` - åˆ é™¤ç»„ä»¶

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»ºå•†æˆ·ç»„ä»¶ç®¡ç†é¡µé¢
- [ ] åˆ›å»ºç»„ä»¶ CRUD API
- [ ] æ›´æ–° ServiceComponentSelector æ˜¾ç¤ºå•†æˆ·ç»„ä»¶

---

## ä¼˜å…ˆçº§æ’åº

| é˜¶æ®µ | ä¼˜å…ˆçº§ | åŸå›  |
|-----|-------|------|
| Phase 1 | P0 | æ•°æ®æ¨¡å‹æ˜¯åŸºç¡€ |
| Phase 2 | P0 | å•†æˆ·æ ¸å¿ƒæ“ä½œæµç¨‹ |
| Phase 3 | P0 | API æ”¯æŒå¿…éœ€ |
| Phase 4 | P1 | å‡çº§åŒ…æ˜¯å¢å€¼åŠŸèƒ½ |
| Phase 5 | P1 | ç”¨æˆ·ç«¯å±•ç¤º |
| Phase 6 | P2 | å•†æˆ·é«˜çº§åŠŸèƒ½ |

---

## å¼€å§‹å®æ–½

### ç¬¬ä¸€æ­¥ï¼šPhase 1 - æ•°æ®æ¨¡å‹æ›´æ–°

1. æ›´æ–° `prisma/schema.prisma`
2. åˆ›å»º migration
3. éªŒè¯æ•°æ®åº“ç»“æ„

å‡†å¤‡å¥½å¼€å§‹äº†å—ï¼Ÿ

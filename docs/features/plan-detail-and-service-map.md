# å¥—é¤è¯¦æƒ…é¡µä¸æœåŠ¡åœ°å›¾è®¾è®¡æ–‡æ¡£

> **ç‰ˆæœ¬**: v10.2
> **æœ€åæ›´æ–°**: 2026-01-20
> **çŠ¶æ€**: å·²å®ç°

---

## 1. æ¦‚è¿°

å¥—é¤è¯¦æƒ…é¡µ (`/plans/[id]`) æ˜¯ç”¨æˆ·äº†è§£å’Œé¢„è®¢å’Œæœç§Ÿèµå¥—é¤çš„æ ¸å¿ƒé¡µé¢ã€‚æœ¬æ–‡æ¡£æè¿°å½“å‰å·²å®ç°çš„åŠŸèƒ½å’Œè®¾è®¡å†³ç­–ã€‚

### 1.1 æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | è·¯å¾„ | æè¿° |
|------|------|------|
| **PlanDetailPage** | `src/app/(main)/plans/[id]/page.tsx` | Server Componentï¼Œæ•°æ®è·å– |
| **PlanDetailClient** | `src/components/PlanDetailClient.tsx` | Client Componentï¼Œé¡µé¢å¸ƒå±€ |
| **ServiceMap** | `src/components/plan/ServiceMap/index.tsx` | æœåŠ¡åœ°å›¾ï¼ˆä¸»æ¨ç»„ä»¶ï¼‰ |
| **InteractiveKimonoMap** | `src/components/plan/InteractiveKimonoMap/` | äº¤äº’çƒ­ç‚¹å›¾ï¼ˆæ—§ç‰ˆï¼‰ |
| **BookingCard** | `src/components/booking/BookingCard.tsx` | é¢„è®¢å¡ç‰‡ |

### 1.2 é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¥—é¤æ ‡é¢˜ + è¯„åˆ† + åœ°åŒº + é™æ—¶æ ‡ç­¾                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚ â”‚                 â”‚       â”‚       â”‚  Airbnb é£æ ¼å›¾ç‰‡ç”»å»Š        â”‚
â”‚ â”‚    ä¸»å›¾ (2x2)   â”‚ å°å›¾1 â”‚ å°å›¾2 â”‚  (2 + 4 ç½‘æ ¼)              â”‚
â”‚ â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚
â”‚ â”‚                 â”‚ å°å›¾3 â”‚ å°å›¾4 â”‚                            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ å·¦ä¾§å†…å®¹åŒº (2/3 å®½åº¦)          â”‚  â”‚ BookingCard (1/3 å®½åº¦)  â”‚ â”‚
â”‚ â”‚                               â”‚  â”‚ - ä»·æ ¼                  â”‚ â”‚
â”‚ â”‚ â”Œâ”€ ServiceMap â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ - æ—¥æœŸé€‰æ‹©              â”‚ â”‚
â”‚ â”‚ â”‚ çƒ­ç‚¹å›¾ + Tab(åˆ—è¡¨/è¯¦æƒ…)   â”‚ â”‚  â”‚ - äººæ•°                  â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ - å¢å€¼æœåŠ¡              â”‚ â”‚
â”‚ â”‚                               â”‚  â”‚ - [ç«‹å³é¢„è®¢]            â”‚ â”‚
â”‚ â”‚ â”Œâ”€ æ´»åŠ¨ä¿¡æ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚                         â”‚ â”‚
â”‚ â”‚ â”‚ (å¦‚æœå…³è”æ´»åŠ¨)             â”‚ â”‚  â”‚ (Sticky æ‚¬æµ®)           â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚                         â”‚ â”‚
â”‚ â”‚                               â”‚  â”‚                         â”‚ â”‚
â”‚ â”‚ â”Œâ”€ é¢„è®¢é¡»çŸ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚                         â”‚ â”‚
â”‚ â”‚ â”‚ å–æ¶ˆæ”¿ç­–ã€è¥ä¸šæ—¶é—´ç­‰       â”‚ â”‚  â”‚                         â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç›¸å…³å¥—é¤æ¨è (æ¨ªå‘æ»šåŠ¨)                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Footer                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ServiceMap ç»„ä»¶ (v10.2)

### 2.1 åŠŸèƒ½æ¦‚è¿°

ServiceMap æ˜¯å¥—é¤è¯¦æƒ…é¡µçš„æ ¸å¿ƒç»„ä»¶ï¼Œå±•ç¤ºå¥—é¤åŒ…å«çš„æ‰€æœ‰æœåŠ¡é¡¹ç›®ã€‚

**ä¸»è¦ç‰¹æ€§**:
- çƒ­ç‚¹å›¾ï¼šå¯è§†åŒ–å±•ç¤ºå’Œæœé…ä»¶ä½ç½®
- Tab åˆ‡æ¢ï¼šå¥—é¤å†…å®¹åˆ—è¡¨ / è¯¦æƒ…é¢æ¿
- OutfitCategory åˆ†ç»„ï¼šæŒ‰æœè£…éƒ¨ä½åˆ†ç±»å±•ç¤º
- å›¾ç‰‡è½®æ’­ï¼šç»„ä»¶è¯¦æƒ…æ”¯æŒå¤šå›¾å±•ç¤º
- å“åº”å¼ï¼šæ¡Œé¢ç«¯åŒæ  / ç§»åŠ¨ç«¯å•æ  + åº•éƒ¨æŠ½å±‰

### 2.2 æ•°æ®ç»“æ„

```typescript
// ç»„ä»¶ç±»å‹ (Prisma enum)
enum ComponentType {
  KIMONO    // å’Œæœæœ¬ä½“
  STYLING   // é€ å‹æœåŠ¡
  ACCESSORY // é…ä»¶
  EXPERIENCE // å¢å€¼ä½“éªŒ
}

// æœè£…åˆ†ç±» (v10.2 æ–°å¢)
enum OutfitCategory {
  MAIN_GARMENT  // ä¸»ä½“æœè£… (order: 1)
  OBI_SET       // è…°å¸¦ç»„ (order: 2)
  INNERWEAR     // å†…æ­å±‚ (order: 3)
  STYLING       // é€ å‹æœåŠ¡ (order: 4)
  ACCESSORIES   // éšèº«é…ä»¶ (order: 5)
  FOOTWEAR      // è¶³éƒ¨ç©¿ç€ (order: 6)
}

// çƒ­ç‚¹æ•°æ®
interface HotspotData {
  id: string;
  x: number;           // çƒ­ç‚¹ X ä½ç½® (0-100 ç™¾åˆ†æ¯”)
  y: number;           // çƒ­ç‚¹ Y ä½ç½® (0-100 ç™¾åˆ†æ¯”)
  labelPosition: "left" | "right" | "top" | "bottom";
  labelOffsetX?: number;  // æ ‡ç­¾åç§»
  labelOffsetY?: number;
  displayOrder: number;
  component: ServiceComponentData;
  isIncluded?: boolean;   // æ˜¯å¦åŒ…å«åœ¨å¥—é¤ä¸­
  quantity?: number;
}

// ç»„ä»¶æ•°æ®
interface ServiceComponentData {
  id: string;
  code: string;
  name: string;
  nameJa?: string;
  nameEn?: string;
  description?: string;
  type: ComponentType;
  icon?: string;          // Emoji å›¾æ ‡
  highlights: string[];   // äº®ç‚¹åˆ—è¡¨
  images: string[];       // ç»„ä»¶å›¾ç‰‡
  isBaseComponent: boolean;
  outfitCategory?: OutfitCategory;  // v10.2: æœè£…åˆ†ç±»
}

// åœ°å›¾æ•°æ®
interface MapData {
  imageUrl: string;       // çƒ­ç‚¹å›¾èƒŒæ™¯
  imageWidth?: number;
  imageHeight?: number;
  hotspots: HotspotData[];
}
```

### 2.3 UI å¸ƒå±€

**æ¡Œé¢ç«¯ (lg+)**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Package Contents                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚                               â”‚ â”‚ [å¥—é¤å†…å®¹] [è¯¦æƒ…]        â”‚â”‚
â”‚ â”‚    çƒ­ç‚¹å›¾åŒºåŸŸ (70%)            â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚                               â”‚ â”‚                          â”‚â”‚
â”‚ â”‚    â—â”€â”€å’Œæœ    â—â”€â”€å¸¯            â”‚ â”‚  ğŸ‘˜ ä¸»ä½“æœè£… (2)         â”‚â”‚
â”‚ â”‚         â—â”€â”€å°ç‰©                â”‚ â”‚  [å’Œæœ] [é•·è¥¦è¢¢]         â”‚â”‚
â”‚ â”‚              â—â”€â”€è‰å±¥           â”‚ â”‚                          â”‚â”‚
â”‚ â”‚                               â”‚ â”‚  ğŸ€ è…°å¸¦ç»„ (3)           â”‚â”‚
â”‚ â”‚   [ç‚¹å‡»çƒ­ç‚¹æŸ¥çœ‹è¯¦æƒ…]           â”‚ â”‚  [å¸¯] [å¸¯ç· ã‚] [å¸¯æšã’]  â”‚â”‚
â”‚ â”‚                               â”‚ â”‚                          â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  ...                     â”‚â”‚
â”‚                                   â”‚                          â”‚â”‚
â”‚                                   â”‚                          â”‚â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç§»åŠ¨ç«¯**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Package Contents        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                      â”‚ â”‚
â”‚ â”‚   çƒ­ç‚¹å›¾ (100%)      â”‚ â”‚
â”‚ â”‚                      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¥—é¤åŒ…å« (12é¡¹)         â”‚
â”‚  ğŸ‘˜ ä¸»ä½“æœè£…             â”‚
â”‚  [å’Œæœ] [é•·è¥¦è¢¢] [...]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     (ç‚¹å‡»ç»„ä»¶å¼¹å‡ºæŠ½å±‰)    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ å’Œæœ                 â”‚â”‚
â”‚  â”‚ å¥—é¤å·²åŒ…å«           â”‚â”‚
â”‚  â”‚ [å›¾ç‰‡è½®æ’­]           â”‚â”‚
â”‚  â”‚ æè¿°...              â”‚â”‚
â”‚  â”‚ Â· äº®ç‚¹1              â”‚â”‚
â”‚  â”‚ Â· äº®ç‚¹2              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 åˆ†ç±»é…ç½®

```typescript
const OUTFIT_CATEGORY_CONFIG: Record<OutfitCategory, {
  label: string;
  icon: string;
  order: number
}> = {
  MAIN_GARMENT: { label: "ä¸»ä½“æœè£…", icon: "ğŸ‘˜", order: 1 },
  OBI_SET:      { label: "è…°å¸¦ç»„",   icon: "ğŸ€", order: 2 },
  INNERWEAR:    { label: "å†…æ­å±‚",   icon: "ğŸ‘•", order: 3 },
  STYLING:      { label: "é€ å‹æœåŠ¡", icon: "ğŸ’‡", order: 4 },
  ACCESSORIES:  { label: "éšèº«é…ä»¶", icon: "ğŸ‘œ", order: 5 },
  FOOTWEAR:     { label: "è¶³éƒ¨ç©¿ç€", icon: "ğŸ‘¡", order: 6 },
};
```

---

## 3. çƒ­ç‚¹ç³»ç»Ÿ

### 3.1 æ•°æ®æ¨¡å‹

çƒ­ç‚¹æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œé€šè¿‡ `getPlanMapData()` å‡½æ•°è·å–ï¼š

```typescript
// src/lib/kimono-map.ts
export async function getPlanMapData(planId: string): Promise<MapData | null> {
  const plan = await prisma.rentalPlan.findUnique({
    where: { id: planId },
    include: {
      planComponents: {
        include: {
          merchantComponent: {
            include: {
              template: true,
              mapHotspot: true,
            }
          }
        }
      }
    }
  });

  // è½¬æ¢ä¸º MapData æ ¼å¼...
}
```

### 3.2 çƒ­ç‚¹æ¸²æŸ“

çƒ­ç‚¹ç»„ä»¶ä½¿ç”¨ `EditorHotspot` å®ç° WYSIWYG ä¸€è‡´æ€§ï¼š

```typescript
// src/components/plan/InteractiveKimonoMap/Hotspot.tsx
export default function Hotspot({ hotspot, onClick, isSelected }) {
  return (
    <EditorHotspot
      hotspot={{
        id: hotspot.id,
        x: hotspot.x,
        y: hotspot.y,
        labelPosition: hotspot.labelPosition,
        name: hotspot.component.name,
        icon: hotspot.component.icon,
        isIncluded: hotspot.isIncluded,
      }}
      onClick={onClick}
      isSelected={isSelected}
      isEditable={false}
    />
  );
}
```

### 3.3 çƒ­ç‚¹äº¤äº’

| äº¤äº’ | æ¡Œé¢ç«¯ | ç§»åŠ¨ç«¯ |
|------|--------|--------|
| ç‚¹å‡»çƒ­ç‚¹ | Tab åˆ‡æ¢åˆ°è¯¦æƒ… | å¼¹å‡ºåº•éƒ¨æŠ½å±‰ |
| ç‚¹å‡»åˆ—è¡¨é¡¹ | Tab åˆ‡æ¢åˆ°è¯¦æƒ… | å¼¹å‡ºåº•éƒ¨æŠ½å±‰ |
| Hover åˆ—è¡¨é¡¹ | çƒ­ç‚¹é«˜äº® | N/A |

---

## 4. InteractiveKimonoMap (æ—§ç‰ˆ)

> **æ³¨æ„**: æ­¤ç»„ä»¶æ˜¯ ServiceMap çš„å‰èº«ï¼Œéƒ¨åˆ†é¡µé¢å¯èƒ½ä»åœ¨ä½¿ç”¨ã€‚

### 4.1 å¸ƒå±€æ¨¡å¼

æ”¯æŒä¸¤ç§å¸ƒå±€ï¼š
- `horizontal` (é»˜è®¤): å·¦å³åˆ†æ ï¼Œå›¾ç‰‡åœ¨å·¦
- `vertical`: ä¸Šä¸‹åˆ†æ ï¼Œå›¾ç‰‡åœ¨ä¸Š

### 4.2 ä¸ ServiceMap çš„å·®å¼‚

| ç‰¹æ€§ | InteractiveKimonoMap | ServiceMap |
|------|---------------------|------------|
| Tab UI | âŒ | âœ… |
| OutfitCategory åˆ†ç»„ | âŒ | âœ… |
| å›¾ç‰‡è½®æ’­ | âŒ | âœ… |
| è‡ªå®šä¹‰èƒŒæ™¯å›¾ | âŒ | âœ… customMapImageUrl |
| å¼•å¯¼åŠ¨ç”» | âŒ | âœ… showGuideAnimation |

---

## 5. è®¾è®¡å†³ç­–è®°å½•

### 5.1 å·²å®ç°

| å†³ç­– | è¯´æ˜ | ç‰ˆæœ¬ |
|------|------|------|
| WYSIWYG çƒ­ç‚¹ | ç¼–è¾‘å™¨å’Œå±•ç¤ºä½¿ç”¨ç›¸åŒç»„ä»¶ | v9.0 |
| ç§»é™¤å‡çº§ç³»ç»Ÿ | ç®€åŒ–å•†æˆ·æ“ä½œï¼Œå‡çº§é€šè¿‡ç‹¬ç«‹å¥—é¤å®ç° | v10.1 |
| OutfitCategory åˆ†ç»„ | æŒ‰æœè£…éƒ¨ä½åˆ†ç±»ï¼Œæå‡æµè§ˆä½“éªŒ | v10.2 |
| Tab UI | åˆ—è¡¨/è¯¦æƒ…åˆ†ç¦»ï¼Œå‡å°‘ä¿¡æ¯è¿‡è½½ | v10.2 |

### 5.2 è®¾è®¡åŸåˆ™

1. **ä¿¡æ¯åˆ†å±‚**: åˆ—è¡¨å±•ç¤ºæ¦‚è§ˆï¼Œè¯¦æƒ…å±•ç¤ºå®Œæ•´ä¿¡æ¯
2. **å“åº”å¼ä¼˜å…ˆ**: ç§»åŠ¨ç«¯ä½¿ç”¨åº•éƒ¨æŠ½å±‰ï¼Œä¿æŒå†…å®¹å¯è®¿é—®
3. **è§†è§‰ä¸€è‡´æ€§**: çƒ­ç‚¹æ ·å¼ä¸ç¼–è¾‘å™¨ä¸€è‡´ (WYSIWYG)
4. **æ¸è¿›å±•ç¤º**: é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªç»„ä»¶ï¼Œé¿å…ç©ºç™½çŠ¶æ€

---

## 6. æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Server Component: PlanDetailPage                                â”‚
â”‚                                                                  â”‚
â”‚  1. prisma.rentalPlan.findUnique()  â† è·å–å¥—é¤æ•°æ®              â”‚
â”‚  2. getPlanMapData(planId)          â† è·å–çƒ­ç‚¹å›¾æ•°æ®            â”‚
â”‚  3. ä¼ é€’ç»™ PlanDetailClient                                     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client Component: PlanDetailClient                              â”‚
â”‚                                                                  â”‚
â”‚  æ¥æ”¶ props: plan, store, mapData, relatedPlans                 â”‚
â”‚                                                                  â”‚
â”‚  æ¸²æŸ“:                                                           â”‚
â”‚  - ServiceMap (ä¼ å…¥ mapData)                                    â”‚
â”‚  - BookingCard (ä¼ å…¥ plan, store)                               â”‚
â”‚  - RelatedPlans (ä¼ å…¥ relatedPlans)                             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Component: ServiceMap                                           â”‚
â”‚                                                                  â”‚
â”‚  çŠ¶æ€ç®¡ç†:                                                        â”‚
â”‚  - selectedItemId: å½“å‰é€‰ä¸­çš„ç»„ä»¶                                â”‚
â”‚  - hoveredItemId: å½“å‰æ‚¬åœçš„ç»„ä»¶                                 â”‚
â”‚  - activeTab: "list" | "detail"                                 â”‚
â”‚  - showMobileDetail: ç§»åŠ¨ç«¯æŠ½å±‰çŠ¶æ€                              â”‚
â”‚                                                                  â”‚
â”‚  æ•°æ®å¤„ç†:                                                        â”‚
â”‚  - æŒ‰ OutfitCategory åˆ†ç»„                                       â”‚
â”‚  - æŒ‰ displayOrder æ’åº                                         â”‚
â”‚  - è¿‡æ»¤ isIncluded é¡¹ç›®                                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. æœªæ¥è§„åˆ’

### 7.1 å¾…å®ç°åŠŸèƒ½

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | æè¿° |
|------|--------|------|
| è´§å¸è½¬æ¢ | P0 | JPY/CNY/TWD å®æ—¶æ±‡ç‡ |
| é¢„è®¢æµç¨‹å¯è§†åŒ– | P1 | "åªéœ€3æ­¥ï¼Œçº¦2åˆ†é’Ÿ" |
| æ—…ç¨‹æ—¶é—´è½´ | P1 | åˆ°åº— â†’ é€‰è¡£ â†’ å˜èº« â†’ æ¼«æ­¥ â†’ å½’è¿˜ |
| FAQ åµŒå…¥ | P1 | åµŒå…¥æ—¶é—´è½´èŠ‚ç‚¹ |
| é”šç‚¹å¯¼èˆª | P2 | AnchorNav å¿«é€Ÿå®šä½ |

### 7.2 è®¾è®¡å‚è€ƒ

**ç«å“ä¼˜åŠ¿** (æ¢¨èŠ±å’Œæœ):
- è´§å¸è½¬æ¢ (4ç§è´§å¸)
- é¢„è®¢æµç¨‹å›¾ (4æ­¥éª¤)
- å‘å‹é€‰é¡¹åˆ†å±‚å±•ç¤º
- åº—é“ºå·®å¼‚åŒ–æ¨è

**æˆ‘ä»¬çš„å·®å¼‚åŒ–**:
- AI è¯•ç©¿ (ç«å“æ²¡æœ‰)
- äº¤äº’å¼çƒ­ç‚¹å›¾ (ç«å“æ²¡æœ‰)
- Japanese Modernism è®¾è®¡è¯­è¨€

---

## 8. ç›¸å…³æ–‡ä»¶

### 8.1 æ ¸å¿ƒç»„ä»¶

```
src/
â”œâ”€â”€ app/(main)/plans/[id]/
â”‚   â”œâ”€â”€ page.tsx              # Server Component å…¥å£
â”‚   â””â”€â”€ loading.tsx           # åŠ è½½çŠ¶æ€
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ PlanDetailClient.tsx  # ä¸»å®¢æˆ·ç«¯ç»„ä»¶
â”‚   â”œâ”€â”€ plan/
â”‚   â”‚   â”œâ”€â”€ ServiceMap/
â”‚   â”‚   â”‚   â””â”€â”€ index.tsx     # æœåŠ¡åœ°å›¾ (æ¨èä½¿ç”¨)
â”‚   â”‚   â””â”€â”€ InteractiveKimonoMap/
â”‚   â”‚       â”œâ”€â”€ index.tsx     # äº¤äº’çƒ­ç‚¹å›¾ (æ—§ç‰ˆ)
â”‚   â”‚       â”œâ”€â”€ Hotspot.tsx   # çƒ­ç‚¹ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ ComponentDetailPanel.tsx
â”‚   â”‚       â””â”€â”€ types.ts      # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ shared/
â”‚   â”‚   â””â”€â”€ EditorHotspot.tsx # ç»Ÿä¸€çƒ­ç‚¹æ ·å¼
â”‚   â””â”€â”€ booking/
â”‚       â””â”€â”€ BookingCard.tsx   # é¢„è®¢å¡ç‰‡
â””â”€â”€ lib/
    â””â”€â”€ kimono-map.ts         # çƒ­ç‚¹å›¾æ•°æ®è·å–
```

### 8.2 æ•°æ®æ¨¡å‹

```prisma
// å¥—é¤ç»„ä»¶å…³è”
model PlanComponent {
  id                String   @id
  planId            String
  merchantComponentId String
  isIncluded        Boolean  @default(true)
  quantity          Int      @default(1)
  displayOrder      Int      @default(0)
}

// å•†æˆ·ç»„ä»¶ (å«çƒ­ç‚¹ä½ç½®)
model MerchantComponent {
  id          String   @id
  merchantId  String
  templateId  String?  // å¹³å°æ¨¡æ¿
  mapHotspot  MapHotspot?
}

// çƒ­ç‚¹ä½ç½®
model MapHotspot {
  id              String   @id
  componentId     String   @unique
  x               Float    // 0-100 ç™¾åˆ†æ¯”
  y               Float
  labelPosition   String   @default("right")
  labelOffsetX    Float?
  labelOffsetY    Float?
}

// å¹³å°ç»„ä»¶æ¨¡æ¿
model ServiceComponentTemplate {
  id              String   @id
  code            String   @unique
  name            String
  type            ComponentType
  outfitCategory  OutfitCategory?
  icon            String?
  description     String?
  highlights      String[]
}
```

---

*æœ¬æ–‡æ¡£åˆå¹¶è‡ª `service-hotmap.md` (v9) å’Œ `plan-detail-design.md` (v1.2)ï¼ŒåŸºäº 2026-01-20 çš„ä»£ç åº“æ›´æ–°ã€‚*
